var __awaiter=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function s(e){try{u(r.next(e))}catch(e){o(e)}}function a(e){try{u(r["throw"](e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(s,a)}u((r=r.apply(e,t||[])).next())})};var __generator=this&&this.__generator||function(e,t){var n={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,s;return s={next:a(0),throw:a(1),return:a(2)},typeof Symbol==="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(e){return function(t){return u([e,t])}}function u(s){if(r)throw new TypeError("Generator is already executing.");while(n)try{if(r=1,i&&(o=s[0]&2?i["return"]:s[0]?i["throw"]||((o=i["return"])&&o.call(i),0):i.next)&&!(o=o.call(i,s[1])).done)return o;if(i=0,o)s=[s[0]&2,o.value];switch(s[0]){case 0:case 1:o=s;break;case 4:n.label++;return{value:s[1],done:false};case 5:n.label++;i=s[1];s=[0];continue;case 7:s=n.ops.pop();n.trys.pop();continue;default:if(!(o=n.trys,o=o.length>0&&o[o.length-1])&&(s[0]===6||s[0]===2)){n=0;continue}if(s[0]===3&&(!o||s[1]>o[0]&&s[1]<o[3])){n.label=s[1];break}if(s[0]===6&&n.label<o[1]){n.label=o[1];o=s;break}if(o&&n.label<o[2]){n.label=o[2];n.ops.push(s);break}if(o[2])n.ops.pop();n.trys.pop();continue}s=t.call(e,n)}catch(e){s=[6,e];i=0}finally{r=o=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:true}}};System.register(["./p-6f2a0351.system.js","./p-c6b679e5.system.js","./p-66b115bd.system.js","./p-4ed6ec38.system.js","./p-659cc05e.system.js","./p-ade40a6b.system.js","./p-d8e4839c.system.js","./p-0096abe1.system.js"],function(e,t){"use strict";var n,r,i,o,s,a,u,c;return{setters:[function(e){n=e.d;r=e.g;i=e.i},function(e){o=e.a;s=e.c},function(){},function(e){a=e.d},function(){},function(){},function(e){u=e.b},function(e){c=e.b}],execute:function(){var t=function(){function e(e,t,n){this.loadBuffer=function(e,t){var n=new XMLHttpRequest;n.open("GET",e,true);n.responseType="arraybuffer";var r=this;n.onload=function(){r.context.decodeAudioData(n.response,function(n){if(!n){alert("error decoding file data: "+e);return}r.bufferList[t]=n;if(++r.loadCount==r.urlList.length)r.onload(r.bufferList)},function(e){console.error("decodeAudioData error",e)})};n.onerror=function(){alert("BufferLoader: XHR error")};n.send()};this.load=function(){for(var e=0;e<this.urlList.length;++e){this.loadBuffer(this.urlList[e],e)}};this.context=e;this.urlList=t;this.onload=n;this.bufferList=new Array;this.loadCount=0}return e}();var h=o(function(e){!function(t){function n(){if(n.prototype._singleton)throw new Error("WebMidi is a singleton, it cannot be instantiated directly.");n.prototype._singleton=this,this._inputs=[],this._outputs=[],this._userHandlers={},this._stateChangeQueue=[],this._processingStateChange=!1,this._midiInterfaceEvents=["connected","disconnected"],this._notes=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],this._semitones={C:0,D:2,E:4,F:5,G:7,A:9,B:11},Object.defineProperties(this,{MIDI_SYSTEM_MESSAGES:{value:{sysex:240,timecode:241,songposition:242,songselect:243,tuningrequest:246,sysexend:247,clock:248,start:250,continue:251,stop:252,activesensing:254,reset:255,midimessage:0,unknownsystemmessage:-1},writable:!1,enumerable:!0,configurable:!1},MIDI_CHANNEL_MESSAGES:{value:{noteoff:8,noteon:9,keyaftertouch:10,controlchange:11,channelmode:11,programchange:12,channelaftertouch:13,pitchbend:14},writable:!1,enumerable:!0,configurable:!1},MIDI_REGISTERED_PARAMETER:{value:{pitchbendrange:[0,0],channelfinetuning:[0,1],channelcoarsetuning:[0,2],tuningprogram:[0,3],tuningbank:[0,4],modulationrange:[0,5],azimuthangle:[61,0],elevationangle:[61,1],gain:[61,2],distanceratio:[61,3],maximumdistance:[61,4],maximumdistancegain:[61,5],referencedistanceratio:[61,6],panspreadangle:[61,7],rollangle:[61,8]},writable:!1,enumerable:!0,configurable:!1},MIDI_CONTROL_CHANGE_MESSAGES:{value:{bankselectcoarse:0,modulationwheelcoarse:1,breathcontrollercoarse:2,footcontrollercoarse:4,portamentotimecoarse:5,dataentrycoarse:6,volumecoarse:7,balancecoarse:8,pancoarse:10,expressioncoarse:11,effectcontrol1coarse:12,effectcontrol2coarse:13,generalpurposeslider1:16,generalpurposeslider2:17,generalpurposeslider3:18,generalpurposeslider4:19,bankselectfine:32,modulationwheelfine:33,breathcontrollerfine:34,footcontrollerfine:36,portamentotimefine:37,dataentryfine:38,volumefine:39,balancefine:40,panfine:42,expressionfine:43,effectcontrol1fine:44,effectcontrol2fine:45,holdpedal:64,portamento:65,sustenutopedal:66,softpedal:67,legatopedal:68,hold2pedal:69,soundvariation:70,resonance:71,soundreleasetime:72,soundattacktime:73,brightness:74,soundcontrol6:75,soundcontrol7:76,soundcontrol8:77,soundcontrol9:78,soundcontrol10:79,generalpurposebutton1:80,generalpurposebutton2:81,generalpurposebutton3:82,generalpurposebutton4:83,reverblevel:91,tremololevel:92,choruslevel:93,celestelevel:94,phaserlevel:95,databuttonincrement:96,databuttondecrement:97,nonregisteredparametercoarse:98,nonregisteredparameterfine:99,registeredparametercoarse:100,registeredparameterfine:101},writable:!1,enumerable:!0,configurable:!1},MIDI_CHANNEL_MODE_MESSAGES:{value:{allsoundoff:120,resetallcontrollers:121,localcontrol:122,allnotesoff:123,omnimodeoff:124,omnimodeon:125,monomodeon:126,polymodeon:127},writable:!1,enumerable:!0,configurable:!1},octaveOffset:{value:0,writable:!0,enumerable:!0,configurable:!1}}),Object.defineProperties(this,{supported:{enumerable:!0,get:function(){return"requestMIDIAccess"in navigator}},enabled:{enumerable:!0,get:function(){return void 0!==this["interface"]}.bind(this)},inputs:{enumerable:!0,get:function(){return this._inputs}.bind(this)},outputs:{enumerable:!0,get:function(){return this._outputs}.bind(this)},sysexEnabled:{enumerable:!0,get:function(){return!(!this["interface"]||!this["interface"].sysexEnabled)}.bind(this)},time:{enumerable:!0,get:function(){return performance.now()}}})}function r(e){var t=this;this._userHandlers={channel:{},system:{}},this._midiInput=e,Object.defineProperties(this,{connection:{enumerable:!0,get:function(){return t._midiInput.connection}},id:{enumerable:!0,get:function(){return t._midiInput.id}},manufacturer:{enumerable:!0,get:function(){return t._midiInput.manufacturer}},name:{enumerable:!0,get:function(){return t._midiInput.name}},state:{enumerable:!0,get:function(){return t._midiInput.state}},type:{enumerable:!0,get:function(){return t._midiInput.type}}}),this._initializeUserHandlers(),this._midiInput.onmidimessage=this._onMidiMessage.bind(this)}function i(e){var t=this;this._midiOutput=e,Object.defineProperties(this,{connection:{enumerable:!0,get:function(){return t._midiOutput.connection}},id:{enumerable:!0,get:function(){return t._midiOutput.id}},manufacturer:{enumerable:!0,get:function(){return t._midiOutput.manufacturer}},name:{enumerable:!0,get:function(){return t._midiOutput.name}},state:{enumerable:!0,get:function(){return t._midiOutput.state}},type:{enumerable:!0,get:function(){return t._midiOutput.type}}})}var o=new n;n.prototype.enable=function(e,t){return this.enabled?void 0:this.supported?void navigator.requestMIDIAccess({sysex:t}).then(function(t){function n(){clearTimeout(r),this._updateInputsAndOutputs(),this["interface"].onstatechange=this._onInterfaceStateChange.bind(this),"function"==typeof e&&e.call(this),i.forEach(function(e){this._onInterfaceStateChange(e)}.bind(this))}var r,i=[],o=[];this["interface"]=t,this._resetInterfaceUserHandlers(),this["interface"].onstatechange=function(e){i.push(e)};for(var s=t.inputs.values(),a=s.next();a&&!a.done;a=s.next())o.push(a.value.open());for(var u=t.outputs.values(),c=u.next();c&&!c.done;c=u.next())o.push(c.value.open());r=setTimeout(n.bind(this),200),Promise&&Promise.all(o)["catch"](function(e){}).then(n.bind(this))}.bind(this),function(t){"function"==typeof e&&e.call(this,t)}.bind(this)):void("function"==typeof e&&e(new Error("The Web MIDI API is not supported by your browser.")))},n.prototype.disable=function(){if(!this.supported)throw new Error("The Web MIDI API is not supported by your browser.");this["interface"]&&(this["interface"].onstatechange=void 0),this["interface"]=void 0,this._inputs=[],this._outputs=[],this._resetInterfaceUserHandlers()},n.prototype.addListener=function(e,t){if(!this.enabled)throw new Error("WebMidi must be enabled before adding event listeners.");if("function"!=typeof t)throw new TypeError("The 'listener' parameter must be a function.");if(!(this._midiInterfaceEvents.indexOf(e)>=0))throw new TypeError("The specified event type is not supported.");return this._userHandlers[e].push(t),this},n.prototype.hasListener=function(e,t){if(!this.enabled)throw new Error("WebMidi must be enabled before checking event listeners.");if("function"!=typeof t)throw new TypeError("The 'listener' parameter must be a function.");if(!(this._midiInterfaceEvents.indexOf(e)>=0))throw new TypeError("The specified event type is not supported.");for(var n=0;n<this._userHandlers[e].length;n++)if(this._userHandlers[e][n]===t)return!0;return!1},n.prototype.removeListener=function(e,t){if(!this.enabled)throw new Error("WebMidi must be enabled before removing event listeners.");if(void 0!==t&&"function"!=typeof t)throw new TypeError("The 'listener' parameter must be a function.");if(this._midiInterfaceEvents.indexOf(e)>=0)if(t)for(var n=0;n<this._userHandlers[e].length;n++)this._userHandlers[e][n]===t&&this._userHandlers[e].splice(n,1);else this._userHandlers[e]=[];else{if(void 0!==e)throw new TypeError("The specified event type is not supported.");this._resetInterfaceUserHandlers()}return this},n.prototype.toMIDIChannels=function(e){var t;return t="all"===e||void 0===e?["all"]:Array.isArray(e)?e:[e],t.indexOf("all")>-1&&(t=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16]),t.map(function(e){return parseInt(e)}).filter(function(e){return e>=1&&16>=e})},n.prototype.getInputById=function(e){if(!this.enabled)throw new Error("WebMidi is not enabled.");e=String(e);for(var t=0;t<this.inputs.length;t++)if(this.inputs[t].id===e)return this.inputs[t];return!1},n.prototype.getOutputById=function(e){if(!this.enabled)throw new Error("WebMidi is not enabled.");e=String(e);for(var t=0;t<this.outputs.length;t++)if(this.outputs[t].id===e)return this.outputs[t];return!1},n.prototype.getInputByName=function(e){if(!this.enabled)throw new Error("WebMidi is not enabled.");for(var t=0;t<this.inputs.length;t++)if(~this.inputs[t].name.indexOf(e))return this.inputs[t];return!1},n.prototype.getOctave=function(e){return null!=e&&e>=0&&127>=e?Math.floor(Math.floor(e)/12-1)+Math.floor(o.octaveOffset):void 0},n.prototype.getOutputByName=function(e){if(!this.enabled)throw new Error("WebMidi is not enabled.");for(var t=0;t<this.outputs.length;t++)if(~this.outputs[t].name.indexOf(e))return this.outputs[t];return!1},n.prototype.guessNoteNumber=function(e){var t=!1;if(e&&e.toFixed&&e>=0&&127>=e?t=Math.round(e):parseInt(e)>=0&&parseInt(e)<=127?t=parseInt(e):("string"==typeof e||e instanceof String)&&(t=this.noteNameToNumber(e)),t===!1)throw new Error("Invalid input value ("+e+").");return t},n.prototype.noteNameToNumber=function(e){"string"!=typeof e&&(e="");var t=e.match(/([CDEFGAB])(#{0,2}|b{0,2})(-?\d+)/i);if(!t)throw new RangeError("Invalid note name.");var n=o._semitones[t[1].toUpperCase()],r=parseInt(t[3]),i=12*(r+1-Math.floor(o.octaveOffset))+n;if(t[2].toLowerCase().indexOf("b")>-1?i-=t[2].length:t[2].toLowerCase().indexOf("#")>-1&&(i+=t[2].length),0>i||i>127)throw new RangeError("Invalid note name or note outside valid range.");return i},n.prototype._updateInputsAndOutputs=function(){this._updateInputs(),this._updateOutputs()},n.prototype._updateInputs=function(){for(var e=0;e<this._inputs.length;e++){for(var t=!0,n=this["interface"].inputs.values(),i=n.next();i&&!i.done;i=n.next())if(this._inputs[e]._midiInput===i.value){t=!1;break}t&&this._inputs.splice(e,1)}this["interface"]&&this["interface"].inputs.forEach(function(e){for(var t=!0,n=0;n<this._inputs.length;n++)this._inputs[n]._midiInput===e&&(t=!1);t&&this._inputs.push(new r(e))}.bind(this))},n.prototype._updateOutputs=function(){for(var e=0;e<this._outputs.length;e++){for(var t=!0,n=this["interface"].outputs.values(),r=n.next();r&&!r.done;r=n.next())if(this._outputs[e]._midiOutput===r.value){t=!1;break}t&&this._outputs.splice(e,1)}this["interface"]&&this["interface"].outputs.forEach(function(e){for(var t=!0,n=0;n<this._outputs.length;n++)this._outputs[n]._midiOutput===e&&(t=!1);t&&this._outputs.push(new i(e))}.bind(this))},n.prototype._onInterfaceStateChange=function(e){this._updateInputsAndOutputs();var t={timestamp:e.timeStamp,type:e.port.state};this["interface"]&&"connected"===e.port.state?"output"===e.port.type?t.port=this.getOutputById(e.port.id):"input"===e.port.type&&(t.port=this.getInputById(e.port.id)):t.port={connection:"closed",id:e.port.id,manufacturer:e.port.manufacturer,name:e.port.name,state:e.port.state,type:e.port.type},this._userHandlers[e.port.state].forEach(function(e){e(t)})},n.prototype._resetInterfaceUserHandlers=function(){for(var e=0;e<this._midiInterfaceEvents.length;e++)this._userHandlers[this._midiInterfaceEvents[e]]=[]},r.prototype.addListener=function(e,t,n){var r=this;if(void 0===t&&(t="all"),Array.isArray(t)||(t=[t]),t.forEach(function(e){if("all"!==e&&!(e>=1&&16>=e))throw new RangeError("The 'channel' parameter is invalid.")}),"function"!=typeof n)throw new TypeError("The 'listener' parameter must be a function.");if(void 0!==o.MIDI_SYSTEM_MESSAGES[e])this._userHandlers.system[e]||(this._userHandlers.system[e]=[]),this._userHandlers.system[e].push(n);else{if(void 0===o.MIDI_CHANNEL_MESSAGES[e])throw new TypeError("The specified event type is not supported.");if(t.indexOf("all")>-1){t=[];for(var i=1;16>=i;i++)t.push(i)}this._userHandlers.channel[e]||(this._userHandlers.channel[e]=[]),t.forEach(function(t){r._userHandlers.channel[e][t]||(r._userHandlers.channel[e][t]=[]),r._userHandlers.channel[e][t].push(n)})}return this},r.prototype.on=r.prototype.addListener,r.prototype.hasListener=function(e,t,n){var r=this;if("function"!=typeof n)throw new TypeError("The 'listener' parameter must be a function.");if(void 0===t&&(t="all"),t.constructor!==Array&&(t=[t]),void 0!==o.MIDI_SYSTEM_MESSAGES[e]){for(var i=0;i<this._userHandlers.system[e].length;i++)if(this._userHandlers.system[e][i]===n)return!0}else if(void 0!==o.MIDI_CHANNEL_MESSAGES[e]){if(t.indexOf("all")>-1){t=[];for(var s=1;16>=s;s++)t.push(s)}return this._userHandlers.channel[e]?t.every(function(t){var i=r._userHandlers.channel[e][t];return i&&i.indexOf(n)>-1}):!1}return!1},r.prototype.removeListener=function(e,t,n){var r=this;if(void 0!==n&&"function"!=typeof n)throw new TypeError("The 'listener' parameter must be a function.");if(void 0===t&&(t="all"),t.constructor!==Array&&(t=[t]),void 0!==o.MIDI_SYSTEM_MESSAGES[e])if(void 0===n)this._userHandlers.system[e]=[];else for(var i=0;i<this._userHandlers.system[e].length;i++)this._userHandlers.system[e][i]===n&&this._userHandlers.system[e].splice(i,1);else if(void 0!==o.MIDI_CHANNEL_MESSAGES[e]){if(t.indexOf("all")>-1){t=[];for(var s=1;16>=s;s++)t.push(s)}if(!this._userHandlers.channel[e])return this;t.forEach(function(t){var i=r._userHandlers.channel[e][t];if(i)if(void 0===n)r._userHandlers.channel[e][t]=[];else for(var o=0;o<i.length;o++)i[o]===n&&i.splice(o,1)})}else{if(void 0!==e)throw new TypeError("The specified event type is not supported.");this._initializeUserHandlers()}return this},r.prototype._initializeUserHandlers=function(){for(var e in o.MIDI_CHANNEL_MESSAGES)o.MIDI_CHANNEL_MESSAGES.hasOwnProperty(e)&&(this._userHandlers.channel[e]={});for(var t in o.MIDI_SYSTEM_MESSAGES)o.MIDI_SYSTEM_MESSAGES.hasOwnProperty(t)&&(this._userHandlers.system[t]=[])},r.prototype._onMidiMessage=function(e){if(this._userHandlers.system.midimessage.length>0){var t={target:this,data:e.data,timestamp:e.timeStamp,type:"midimessage"};this._userHandlers.system.midimessage.forEach(function(e){e(t)})}e.data[0]<240?this._parseChannelEvent(e):e.data[0]<=255&&this._parseSystemEvent(e)},r.prototype._parseChannelEvent=function(e){var t,n,r=e.data[0]>>4,i=(15&e.data[0])+1;e.data.length>1&&(t=e.data[1],n=e.data.length>2?e.data[2]:void 0);var s={target:this,data:e.data,timestamp:e.timeStamp,channel:i};r===o.MIDI_CHANNEL_MESSAGES.noteoff||r===o.MIDI_CHANNEL_MESSAGES.noteon&&0===n?(s.type="noteoff",s.note={number:t,name:o._notes[t%12],octave:o.getOctave(t)},s.velocity=n/127,s.rawVelocity=n):r===o.MIDI_CHANNEL_MESSAGES.noteon?(s.type="noteon",s.note={number:t,name:o._notes[t%12],octave:o.getOctave(t)},s.velocity=n/127,s.rawVelocity=n):r===o.MIDI_CHANNEL_MESSAGES.keyaftertouch?(s.type="keyaftertouch",s.note={number:t,name:o._notes[t%12],octave:o.getOctave(t)},s.value=n/127):r===o.MIDI_CHANNEL_MESSAGES.controlchange&&t>=0&&119>=t?(s.type="controlchange",s.controller={number:t,name:this.getCcNameByNumber(t)},s.value=n):r===o.MIDI_CHANNEL_MESSAGES.channelmode&&t>=120&&127>=t?(s.type="channelmode",s.controller={number:t,name:this.getChannelModeByNumber(t)},s.value=n):r===o.MIDI_CHANNEL_MESSAGES.programchange?(s.type="programchange",s.value=t):r===o.MIDI_CHANNEL_MESSAGES.channelaftertouch?(s.type="channelaftertouch",s.value=t/127):r===o.MIDI_CHANNEL_MESSAGES.pitchbend?(s.type="pitchbend",s.value=((n<<7)+t-8192)/8192):s.type="unknownchannelmessage",this._userHandlers.channel[s.type]&&this._userHandlers.channel[s.type][i]&&this._userHandlers.channel[s.type][i].forEach(function(e){e(s)})},r.prototype.getCcNameByNumber=function(e){if(e=Math.floor(e),!(e>=0&&119>=e))throw new RangeError("The control change number must be between 0 and 119.");for(var t in o.MIDI_CONTROL_CHANGE_MESSAGES)if(o.MIDI_CONTROL_CHANGE_MESSAGES.hasOwnProperty(t)&&e===o.MIDI_CONTROL_CHANGE_MESSAGES[t])return t;return void 0},r.prototype.getChannelModeByNumber=function(e){if(e=Math.floor(e),!(e>=120&&status<=127))throw new RangeError("The control change number must be between 120 and 127.");for(var t in o.MIDI_CHANNEL_MODE_MESSAGES)if(o.MIDI_CHANNEL_MODE_MESSAGES.hasOwnProperty(t)&&e===o.MIDI_CHANNEL_MODE_MESSAGES[t])return t},r.prototype._parseSystemEvent=function(e){var t=e.data[0],n={target:this,data:e.data,timestamp:e.timeStamp};t===o.MIDI_SYSTEM_MESSAGES.sysex?n.type="sysex":t===o.MIDI_SYSTEM_MESSAGES.timecode?n.type="timecode":t===o.MIDI_SYSTEM_MESSAGES.songposition?n.type="songposition":t===o.MIDI_SYSTEM_MESSAGES.songselect?(n.type="songselect",n.song=e.data[1]):t===o.MIDI_SYSTEM_MESSAGES.tuningrequest?n.type="tuningrequest":t===o.MIDI_SYSTEM_MESSAGES.clock?n.type="clock":t===o.MIDI_SYSTEM_MESSAGES.start?n.type="start":t===o.MIDI_SYSTEM_MESSAGES["continue"]?n.type="continue":t===o.MIDI_SYSTEM_MESSAGES.stop?n.type="stop":t===o.MIDI_SYSTEM_MESSAGES.activesensing?n.type="activesensing":t===o.MIDI_SYSTEM_MESSAGES.reset?n.type="reset":n.type="unknownsystemmessage",this._userHandlers.system[n.type]&&this._userHandlers.system[n.type].forEach(function(e){e(n)})},i.prototype.send=function(e,t,n){if(!(e>=128&&255>=e))throw new RangeError("The status byte must be an integer between 128 (0x80) and 255 (0xFF).");void 0===t&&(t=[]),Array.isArray(t)||(t=[t]);var r=[];return t.forEach(function(e,t){var n=Math.floor(e);if(!(n>=0&&255>=n))throw new RangeError("Data bytes must be integers between 0 (0x00) and 255 (0xFF).");r.push(n)}),this._midiOutput.send([e].concat(r),parseFloat(n)||0),this},i.prototype.sendSysex=function(e,t,n){if(!o.sysexEnabled)throw new Error("Sysex message support must first be activated.");return n=n||{},e=[].concat(e),t.forEach(function(e){if(0>e||e>127)throw new RangeError("The data bytes of a sysex message must be integers between 0 (0x00) and 127 (0x7F).")}),t=e.concat(t,o.MIDI_SYSTEM_MESSAGES.sysexend),this.send(o.MIDI_SYSTEM_MESSAGES.sysex,t,this._parseTimeParameter(n.time)),this},i.prototype.sendTimecodeQuarterFrame=function(e,t){return t=t||{},this.send(o.MIDI_SYSTEM_MESSAGES.timecode,e,this._parseTimeParameter(t.time)),this},i.prototype.sendSongPosition=function(e,t){e=Math.floor(e)||0,t=t||{};var n=e>>7&127,r=127&e;return this.send(o.MIDI_SYSTEM_MESSAGES.songposition,[n,r],this._parseTimeParameter(t.time)),this},i.prototype.sendSongSelect=function(e,t){if(e=Math.floor(e),t=t||{},!(e>=0&&127>=e))throw new RangeError("The song number must be between 0 and 127.");return this.send(o.MIDI_SYSTEM_MESSAGES.songselect,[e],this._parseTimeParameter(t.time)),this},i.prototype.sendTuningRequest=function(e){return e=e||{},this.send(o.MIDI_SYSTEM_MESSAGES.tuningrequest,void 0,this._parseTimeParameter(e.time)),this},i.prototype.sendClock=function(e){return e=e||{},this.send(o.MIDI_SYSTEM_MESSAGES.clock,void 0,this._parseTimeParameter(e.time)),this},i.prototype.sendStart=function(e){return e=e||{},this.send(o.MIDI_SYSTEM_MESSAGES.start,void 0,this._parseTimeParameter(e.time)),this},i.prototype.sendContinue=function(e){return e=e||{},this.send(o.MIDI_SYSTEM_MESSAGES["continue"],void 0,this._parseTimeParameter(e.time)),this},i.prototype.sendStop=function(e){return e=e||{},this.send(o.MIDI_SYSTEM_MESSAGES.stop,void 0,this._parseTimeParameter(e.time)),this},i.prototype.sendActiveSensing=function(e){return e=e||{},this.send(o.MIDI_SYSTEM_MESSAGES.activesensing,[],this._parseTimeParameter(e.time)),this},i.prototype.sendReset=function(e){return e=e||{},this.send(o.MIDI_SYSTEM_MESSAGES.reset,void 0,this._parseTimeParameter(e.time)),this},i.prototype.stopNote=function(e,t,n){if("all"===e)return this.sendChannelMode("allnotesoff",0,t,n);var r=64;return n=n||{},n.rawVelocity?!isNaN(n.velocity)&&n.velocity>=0&&n.velocity<=127&&(r=n.velocity):!isNaN(n.velocity)&&n.velocity>=0&&n.velocity<=1&&(r=127*n.velocity),this._convertNoteToArray(e).forEach(function(e){o.toMIDIChannels(t).forEach(function(t){this.send((o.MIDI_CHANNEL_MESSAGES.noteoff<<4)+(t-1),[e,Math.round(r)],this._parseTimeParameter(n.time))}.bind(this))}.bind(this)),this},i.prototype.playNote=function(e,t,n){var r,i=64;if(n=n||{},n.rawVelocity?!isNaN(n.velocity)&&n.velocity>=0&&n.velocity<=127&&(i=n.velocity):!isNaN(n.velocity)&&n.velocity>=0&&n.velocity<=1&&(i=127*n.velocity),r=this._parseTimeParameter(n.time),this._convertNoteToArray(e).forEach(function(e){o.toMIDIChannels(t).forEach(function(t){this.send((o.MIDI_CHANNEL_MESSAGES.noteon<<4)+(t-1),[e,Math.round(i)],r)}.bind(this))}.bind(this)),!isNaN(n.duration)){n.duration<=0&&(n.duration=0);var s=64;n.rawVelocity?!isNaN(n.release)&&n.release>=0&&n.release<=127&&(s=n.release):!isNaN(n.release)&&n.release>=0&&n.release<=1&&(s=127*n.release),this._convertNoteToArray(e).forEach(function(e){o.toMIDIChannels(t).forEach(function(t){this.send((o.MIDI_CHANNEL_MESSAGES.noteoff<<4)+(t-1),[e,Math.round(s)],(r||o.time)+n.duration)}.bind(this))}.bind(this))}return this},i.prototype.sendKeyAftertouch=function(e,t,n,r){var i=this;if(r=r||{},1>t||t>16)throw new RangeError("The channel must be between 1 and 16.");(isNaN(n)||0>n||n>1)&&(n=.5);var s=Math.round(127*n);return this._convertNoteToArray(e).forEach(function(e){o.toMIDIChannels(t).forEach(function(t){i.send((o.MIDI_CHANNEL_MESSAGES.keyaftertouch<<4)+(t-1),[e,s],i._parseTimeParameter(r.time))})}),this},i.prototype.sendControlChange=function(e,t,n,r){if(r=r||{},"string"==typeof e){if(e=o.MIDI_CONTROL_CHANGE_MESSAGES[e],void 0===e)throw new TypeError("Invalid controller name.")}else if(e=Math.floor(e),!(e>=0&&119>=e))throw new RangeError("Controller numbers must be between 0 and 119.");if(t=Math.floor(t)||0,!(t>=0&&127>=t))throw new RangeError("Controller value must be between 0 and 127.");return o.toMIDIChannels(n).forEach(function(n){this.send((o.MIDI_CHANNEL_MESSAGES.controlchange<<4)+(n-1),[e,t],this._parseTimeParameter(r.time))}.bind(this)),this},i.prototype._selectRegisteredParameter=function(e,t,n){var r=this;if(e[0]=Math.floor(e[0]),!(e[0]>=0&&e[0]<=127))throw new RangeError("The control65 value must be between 0 and 127");if(e[1]=Math.floor(e[1]),!(e[1]>=0&&e[1]<=127))throw new RangeError("The control64 value must be between 0 and 127");return o.toMIDIChannels(t).forEach(function(i){r.sendControlChange(101,e[0],t,{time:n}),r.sendControlChange(100,e[1],t,{time:n})}),this},i.prototype._selectNonRegisteredParameter=function(e,t,n){var r=this;if(e[0]=Math.floor(e[0]),!(e[0]>=0&&e[0]<=127))throw new RangeError("The control63 value must be between 0 and 127");if(e[1]=Math.floor(e[1]),!(e[1]>=0&&e[1]<=127))throw new RangeError("The control62 value must be between 0 and 127");return o.toMIDIChannels(t).forEach(function(i){r.sendControlChange(99,e[0],t,{time:n}),r.sendControlChange(98,e[1],t,{time:n})}),this},i.prototype._setCurrentRegisteredParameter=function(e,t,n){var r=this;if(e=[].concat(e),e[0]=Math.floor(e[0]),!(e[0]>=0&&e[0]<=127))throw new RangeError("The msb value must be between 0 and 127");return o.toMIDIChannels(t).forEach(function(i){r.sendControlChange(6,e[0],t,{time:n})}),e[1]=Math.floor(e[1]),e[1]>=0&&e[1]<=127&&o.toMIDIChannels(t).forEach(function(i){r.sendControlChange(38,e[1],t,{time:n})}),this},i.prototype._deselectRegisteredParameter=function(e,t){var n=this;return o.toMIDIChannels(e).forEach(function(r){n.sendControlChange(101,127,e,{time:t}),n.sendControlChange(100,127,e,{time:t})}),this},i.prototype.setRegisteredParameter=function(e,t,n,r){var i=this;if(r=r||{},!Array.isArray(e)){if(!o.MIDI_REGISTERED_PARAMETER[e])throw new Error("The specified parameter is not available.");e=o.MIDI_REGISTERED_PARAMETER[e]}return o.toMIDIChannels(n).forEach(function(o){i._selectRegisteredParameter(e,n,r.time),i._setCurrentRegisteredParameter(t,n,r.time),i._deselectRegisteredParameter(n,r.time)}),this},i.prototype.setNonRegisteredParameter=function(e,t,n,r){var i=this;if(r=r||{},!(e[0]>=0&&e[0]<=127&&e[1]>=0&&e[1]<=127))throw new Error("Position 0 and 1 of the 2-position parameter array must both be between 0 and 127.");return t=[].concat(t),o.toMIDIChannels(n).forEach(function(o){i._selectNonRegisteredParameter(e,n,r.time),i._setCurrentRegisteredParameter(t,n,r.time),i._deselectRegisteredParameter(n,r.time)}),this},i.prototype.incrementRegisteredParameter=function(e,t,n){var r=this;if(n=n||{},!Array.isArray(e)){if(!o.MIDI_REGISTERED_PARAMETER[e])throw new Error("The specified parameter is not available.");e=o.MIDI_REGISTERED_PARAMETER[e]}return o.toMIDIChannels(t).forEach(function(i){r._selectRegisteredParameter(e,t,n.time),r.sendControlChange(96,0,t,{time:n.time}),r._deselectRegisteredParameter(t,n.time)}),this},i.prototype.decrementRegisteredParameter=function(e,t,n){if(n=n||{},!Array.isArray(e)){if(!o.MIDI_REGISTERED_PARAMETER[e])throw new TypeError("The specified parameter is not available.");e=o.MIDI_REGISTERED_PARAMETER[e]}return o.toMIDIChannels(t).forEach(function(r){this._selectRegisteredParameter(e,t,n.time),this.sendControlChange(97,0,t,{time:n.time}),this._deselectRegisteredParameter(t,n.time)}.bind(this)),this},i.prototype.setPitchBendRange=function(e,t,n,r){var i=this;if(r=r||{},e=Math.floor(e)||0,!(e>=0&&127>=e))throw new RangeError("The semitones value must be between 0 and 127");if(t=Math.floor(t)||0,!(t>=0&&127>=t))throw new RangeError("The cents value must be between 0 and 127");return o.toMIDIChannels(n).forEach(function(o){i.setRegisteredParameter("pitchbendrange",[e,t],n,{time:r.time})}),this},i.prototype.setModulationRange=function(e,t,n,r){var i=this;if(r=r||{},e=Math.floor(e)||0,!(e>=0&&127>=e))throw new RangeError("The semitones value must be between 0 and 127");if(t=Math.floor(t)||0,!(t>=0&&127>=t))throw new RangeError("The cents value must be between 0 and 127");return o.toMIDIChannels(n).forEach(function(o){i.setRegisteredParameter("modulationrange",[e,t],n,{time:r.time})}),this},i.prototype.setMasterTuning=function(e,t,n){var r=this;if(n=n||{},e=parseFloat(e)||0,-65>=e||e>=64)throw new RangeError("The value must be a decimal number larger than -65 and smaller than 64.");var i=Math.floor(e)+64,s=e-Math.floor(e);s=Math.round((s+1)/2*16383);var a=s>>7&127,u=127&s;return o.toMIDIChannels(t).forEach(function(e){r.setRegisteredParameter("channelcoarsetuning",i,t,{time:n.time}),r.setRegisteredParameter("channelfinetuning",[a,u],t,{time:n.time})}),this},i.prototype.setTuningProgram=function(e,t,n){var r=this;if(n=n||{},e=Math.floor(e),!(e>=0&&127>=e))throw new RangeError("The program value must be between 0 and 127");return o.toMIDIChannels(t).forEach(function(i){r.setRegisteredParameter("tuningprogram",e,t,{time:n.time})}),this},i.prototype.setTuningBank=function(e,t,n){var r=this;if(n=n||{},e=Math.floor(e)||0,!(e>=0&&127>=e))throw new RangeError("The bank value must be between 0 and 127");return o.toMIDIChannels(t).forEach(function(i){r.setRegisteredParameter("tuningbank",e,t,{time:n.time})}),this},i.prototype.sendChannelMode=function(e,t,n,r){if(r=r||{},"string"==typeof e){if(e=o.MIDI_CHANNEL_MODE_MESSAGES[e],!e)throw new TypeError("Invalid channel mode message name.")}else if(e=Math.floor(e),!(e>=120&&127>=e))throw new RangeError("Channel mode numerical identifiers must be between 120 and 127.");if(t=Math.floor(t)||0,0>t||t>127)throw new RangeError("Value must be an integer between 0 and 127.");return o.toMIDIChannels(n).forEach(function(n){this.send((o.MIDI_CHANNEL_MESSAGES.channelmode<<4)+(n-1),[e,t],this._parseTimeParameter(r.time))}.bind(this)),this},i.prototype.sendProgramChange=function(e,t,n){var r=this;if(n=n||{},e=Math.floor(e),isNaN(e)||0>e||e>127)throw new RangeError("Program numbers must be between 0 and 127.");return o.toMIDIChannels(t).forEach(function(t){r.send((o.MIDI_CHANNEL_MESSAGES.programchange<<4)+(t-1),[e],r._parseTimeParameter(n.time))}),this},i.prototype.sendChannelAftertouch=function(e,t,n){var r=this;n=n||{},e=parseFloat(e),(isNaN(e)||0>e||e>1)&&(e=.5);var i=Math.round(127*e);return o.toMIDIChannels(t).forEach(function(e){r.send((o.MIDI_CHANNEL_MESSAGES.channelaftertouch<<4)+(e-1),[i],r._parseTimeParameter(n.time))}),this},i.prototype.sendPitchBend=function(e,t,n){var r=this;if(n=n||{},isNaN(e)||-1>e||e>1)throw new RangeError("Pitch bend value must be between -1 and 1.");var i=Math.round((e+1)/2*16383),s=i>>7&127,a=127&i;return o.toMIDIChannels(t).forEach(function(e){r.send((o.MIDI_CHANNEL_MESSAGES.pitchbend<<4)+(e-1),[a,s],r._parseTimeParameter(n.time))}),this},i.prototype._parseTimeParameter=function(e){var t,n=parseFloat(e);return"string"==typeof e&&"+"===e.substring(0,1)?n&&n>0&&(t=o.time+n):n>o.time&&(t=n),t},i.prototype._convertNoteToArray=function(e){var t=[];return Array.isArray(e)||(e=[e]),e.forEach(function(e){t.push(o.guessNoteNumber(e))}),t},e.exports?e.exports=o:t.WebMidi||(t.WebMidi=o)}(s)});var l=function(){function e(e){n(this,e);this.name="web_audio";this.prepared=false;this.midi=false;this.sources=[];this.keys={}}e.prototype.source=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:if(!(this.sources.length===0))return[3,2];return[4,this.connect_the_world()];case 1:t.sent();t.label=2;case 2:return[2,this.sources[e]]}})})};e.prototype.get_context=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,this.context]})})};e.prototype.is_prepared=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,this.prepared]})})};e.prototype.componentDidLoad=function(){this.connect_debugger()};e.prototype.connect_the_world=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){this.connect_context();this.gain=this.context.createGain();this.connect_visualizers();this.connect_sources();this.connect_midi();this.prepared=true;return[2,true]})})};e.prototype.connect_context=function(){this.context=new(window.AudioContext||window.webkitAudioContext);this.log("Connected to this.context")};e.prototype.connect_sources=function(){this.build_sources()};e.prototype.build_sources=function(){return __awaiter(this,void 0,void 0,function(){var e=this;return __generator(this,function(n){this.log("Building sources");this._sources=Array.from(this.element.querySelectorAll("web-audio-source"));this.externalFiles=[];this._sources.forEach(function(n,r){e.log("("+r+") Preparing "+n.name);e.sources[n.name]=n;var i=new t(e.context,[n.src],function(t){e.cache_sources(t,n)});i.load()},this);return[2]})})};e.prototype.cache_sources=function(e,t){return __awaiter(this,void 0,void 0,function(){var n=this;return __generator(this,function(r){switch(r.label){case 0:return[4,c(20)];case 1:r.sent();e.forEach(function(e){n.log("Caching "+t.name);if(n.midi){n.log("Assigned "+t.name+" to midi key "+t.midikey+", channel "+t.midichannel);if(n.keys[t.midichannel]==undefined){n.keys[t.midichannel]=[]}n.keys[t.midichannel][t.midikey]=t}n._currentSource=t;n._currentSource.assignBuffer(n,e);n.log("Source "+t.name+" is ready")});this._currentSource=null;return[2]}})})};e.prototype.connect_visualizers=function(){return __awaiter(this,void 0,void 0,function(){var e=this;return __generator(this,function(t){switch(t.label){case 0:return[4,c(20)];case 1:t.sent();this.visualizers=Array.from(document.querySelectorAll('web-audio-visualizer[for="'+this.name+'"]'));if(!this.visualizers)return[3,3];this.log("Attaching visualizers");return[4,a(this.visualizers,function(t,n){return __awaiter(e,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:if(!(n===0))return[3,2];return[4,t.connect(this.context,this.context.destination)];case 1:t=e.sent();return[3,4];case 2:return[4,t.connect(this.context,this.previousVisualizer.analyser)];case 3:t=e.sent();e.label=4;case 4:this.previousVisualizer=t;return[2]}})})})];case 2:t.sent();return[3,4];case 3:this.log("No visualizers for "+this.name);t.label=4;case 4:if(!(this.visualizers.length>=1))return[3,6];return[4,this.gain.connect(this.previousVisualizer.analyser)];case 5:t.sent();return[3,8];case 6:return[4,this.gain.connect(this.context.destination)];case 7:t.sent();t.label=8;case 8:return[2]}})})};e.prototype.connect_debugger=function(){this.debugger=document.querySelector('web-audio-debugger[for="'+this.name+'"]');this.log("Connected debugger")};e.prototype.log=function(e){if(this.debugger){this.debugger.addHistory(e)}};e.prototype.connect_midi=function(){var e=this;if(this.midi){h.enable(function(t){if(t){e.log("Midi couldn't be enabled."+t)}else{e.log("Midi is enabled")}var n=h.inputs[0];if(n){n.addListener("noteon","all",function(t){e.log("KEY: Channel: "+t.channel+", Note: "+t.note.number+", Name: "+t.note.name+", Oct: "+t.note.octave);if(e.keys[t.channel]){e.keys[t.channel][t.note.number].gain().value=t.data[2]/175;e.keys[t.channel][t.note.number].play()}});n.addListener("pitchbend","all",function(t){e.log("PITCH: Channel: "+t.channel+", Value: "+t.value)});n.addListener("controlchange","all",function(t){e.log("CTRL: Channel: "+t.channel+", controller: "+t.controller.number+", Value: "+t.value);var n=new CustomEvent("midi-controller-update",{detail:t});document.dispatchEvent(n)});e.log("Listeners added for notes, pitch bend, and controllers.")}})}};Object.defineProperty(e.prototype,"element",{get:function(){return r(this)},enumerable:true,configurable:true});return e}();e("web_audio",l);var f=function(){function e(e){n(this,e);this.inert=false;this.midikey=0;this.midichannel=1;this.status="paused";this.effectsvolume=100;this.effects=[];this.duration=0;this.startTime=0;this.pausedTime=0;this.elapsedTime=0;this.playing=false;this.timeupdate=i(this,"timeupdate",7)}e.prototype.getBuffer=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,this.buffer]})})};e.prototype.webAudio=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,this.webAudioWrapper]})})};e.prototype.gain=function(e){if(e===void 0){e="wet"}return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){if(e==="wet"){return[2,this.wetGain]}else if(e==="dry"){return[2,this.dryGain]}else if(e==="channel"){return[2,this.channelGain]}return[2]})})};e.prototype.getDuration=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,this.duration]})})};e.prototype.currentTime=function(){var e=0;if(this.pausedTime){e=this.pausedTime}else{if(this.startTime){e=this.context.currentTime-this.startTime}}if(e>=this.duration){e=this.duration}return e};e.prototype.prepare=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){if(!this.inert){this.source=this.context.createBufferSource();this.source.buffer=this.buffer;if(this.wetGain){this.wetGain.gain.value=this.effectsvolume/100;this.dryGain.gain.value=Math.abs((this.effectsvolume-100)/100)}else{this.dryGain.gain.value=1}if(this.wetGain){this.source.connect(this.wetGain)}this.source.connect(this.dryGain);this.duration=this.source.buffer.duration}return[2]})})};e.prototype.play=function(){return __awaiter(this,void 0,void 0,function(){var e=this;return __generator(this,function(t){if(!this.inert){this.prepare();this.source.start(0,this.pausedTime);this.startTime=this.context.currentTime-this.pausedTime;this.pausedTime=0;this.playing=true;this.tick();u(function(){e.tick()})}else{throw"Cannot play inert media."}return[2]})})};e.prototype.skipTo=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){this.stop();this.pausedTime=e/1e3;this.play();return[2]})})};e.prototype.pause=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){this.elapsedTime=this.context.currentTime-this.startTime;this.stop();this.pausedTime=this.elapsedTime;this.playing=false;return[2]})})};e.prototype.toggle=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){if(this.playing){this.pause()}else{this.play()}return[2]})})};e.prototype.stop=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){if(this.source){this.source.disconnect();this.source.stop()}this.source=null;this.pausedTime=0;this.startTime=0;this.playing=false;return[2]})})};e.prototype.tick=function(){var e=this;this.timeupdate.emit({time:this.currentTime(),duration:this.duration});if(this.source){u(function(){e.tick()})}};e.prototype.assignBuffer=function(e,t){return __awaiter(this,void 0,void 0,function(){var n;var r=this;return __generator(this,function(i){switch(i.label){case 0:this.webAudioWrapper=e.element;this.context=e.context;this.buffer=t;if(!!this.inert)return[3,2];this.masterGain=e.gain;this.channelGain=this.context.createGain();return[4,this.prepareEffects()];case 1:i.sent();if(Object.keys(this.effects).length>0){this.wetGain=this.context.createGain();n="";Object.keys(this.effects).reverse().forEach(function(e,t){if(t===0){r.wetGain.connect(r.effects[e])}else{r.effects[n].connect(r.effects[e])}n=e});this.effects[n].connect(this.channelGain)}this.dryGain=this.context.createGain();this.dryGain.connect(this.channelGain);this.channelGain.connect(this.masterGain);i.label=2;case 2:return[2]}})})};e.prototype.prepareEffects=function(){return __awaiter(this,void 0,void 0,function(){var e,t,n;return __generator(this,function(r){switch(r.label){case 0:if(!(this.element.parentElement.nodeName!=="WEB-AUDIO"))return[3,3];e=this.element.parentElement;r.label=1;case 1:if(!(e.nodeName!=="WEB-AUDIO"))return[3,3];t=this.effects;n=e.getAttribute("name");return[4,e.attachEffect(this.context,this.element)];case 2:t[n]=r.sent();e=e.parentElement;return[3,1];case 3:return[2]}})})};Object.defineProperty(e.prototype,"element",{get:function(){return r(this)},enumerable:true,configurable:true});return e}();e("web_audio_source",f)}}});