var __awaiter=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(a,i){function o(e){try{u(n.next(e))}catch(e){i(e)}}function s(e){try{u(n["throw"](e))}catch(e){i(e)}}function u(e){e.done?a(e.value):new r(function(t){t(e.value)}).then(o,s)}u((n=n.apply(e,t||[])).next())})};var __generator=this&&this.__generator||function(e,t){var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,a,i,o;return o={next:s(0),throw:s(1),return:s(2)},typeof Symbol==="function"&&(o[Symbol.iterator]=function(){return this}),o;function s(e){return function(t){return u([e,t])}}function u(o){if(n)throw new TypeError("Generator is already executing.");while(r)try{if(n=1,a&&(i=o[0]&2?a["return"]:o[0]?a["throw"]||((i=a["return"])&&i.call(a),0):a.next)&&!(i=i.call(a,o[1])).done)return i;if(a=0,i)o=[o[0]&2,i.value];switch(o[0]){case 0:case 1:i=o;break;case 4:r.label++;return{value:o[1],done:false};case 5:r.label++;a=o[1];o=[0];continue;case 7:o=r.ops.pop();r.trys.pop();continue;default:if(!(i=r.trys,i=i.length>0&&i[i.length-1])&&(o[0]===6||o[0]===2)){r=0;continue}if(o[0]===3&&(!i||o[1]>i[0]&&o[1]<i[3])){r.label=o[1];break}if(o[0]===6&&r.label<i[1]){r.label=i[1];i=o;break}if(i&&r.label<i[2]){r.label=i[2];r.ops.push(o);break}if(i[2])r.ops.pop();r.trys.pop();continue}o=t.call(e,r)}catch(e){o=[6,e];a=0}finally{n=i=0}if(o[0]&5)throw o[1];return{value:o[0]?o[1]:void 0,done:true}}};System.register(["./p-6f2a0351.system.js","./p-c6b679e5.system.js","./p-66b115bd.system.js","./p-4ed6ec38.system.js","./p-659cc05e.system.js","./p-ade40a6b.system.js"],function(e,t){"use strict";var r,n,a,i,o,s,u,f,l;return{setters:[function(e){r=e.d;n=e.i;a=e.f;i=e.g},function(e){o=e.a;s=e.b;u=e.e},function(){},function(e){f=e.i;l=e.j},function(){},function(){}],execute:function(){var t=o(function(e,t){(function(t){{e.exports=t()}})(function(){return function e(t,r,n){function a(o,u){if(!r[o]){if(!t[o]){var f=typeof s=="function"&&s;if(!u&&f)return f(o,!0);if(i)return i(o,!0);var l=new Error("Cannot find module '"+o+"'");throw l.code="MODULE_NOT_FOUND",l}var c=r[o]={exports:{}};t[o][0].call(c.exports,function(e){var r=t[o][1][e];return a(r?r:e)},c,c.exports,e,t,r,n)}return r[o].exports}var i=typeof s=="function"&&s;for(var o=0;o<n.length;o++)a(n[o]);return a}({1:[function(e,t,r){},{}],2:[function(e,t,r){t.exports=XMLHttpRequest},{}],3:[function(e,t,r){var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||false;n.configurable=true;if("value"in n)n.writable=true;Object.defineProperty(e,n.key,n)}}return function(t,r,n){if(r)e(t.prototype,r);if(n)e(t,n);return t}}();function a(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function i(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function o(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var s=e("./MediaFileReader");var u=function(e){o(t,e);function t(e){a(this,t);var r=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));r._array=e;r._size=e.length;r._isInitialized=true;return r}n(t,[{key:"init",value:function e(t){setTimeout(t.onSuccess,0)}},{key:"loadRange",value:function e(t,r){setTimeout(r.onSuccess,0)}},{key:"getByteAt",value:function e(t){if(t>=this._array.length){throw new Error("Offset "+t+" hasn't been loaded yet.")}return this._array[t]}}],[{key:"canReadFile",value:function e(t){return Array.isArray(t)||typeof Buffer==="function"&&Buffer.isBuffer(t)}}]);return t}(s);t.exports=u},{"./MediaFileReader":11}],4:[function(e,t,r){var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||false;n.configurable=true;if("value"in n)n.writable=true;Object.defineProperty(e,n.key,n)}}return function(t,r,n){if(r)e(t.prototype,r);if(n)e(t,n);return t}}();function a(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function i(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function o(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var s=e("./ChunkedFileData");var u=e("./MediaFileReader");var f=function(e){o(t,e);function t(e){a(this,t);var r=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));r._blob=e;r._fileData=new s;return r}n(t,[{key:"_init",value:function e(t){this._size=this._blob.size;setTimeout(t.onSuccess,1)}},{key:"loadRange",value:function e(t,r){var n=this;var a=this._blob.slice||this._blob.mozSlice||this._blob.webkitSlice;var i=a.call(this._blob,t[0],t[1]+1);var o=new FileReader;o.onloadend=function(e){var a=new Uint8Array(o.result);n._fileData.addData(t[0],a);r.onSuccess()};o.onerror=o.onabort=function(e){if(r.onError){r.onError({type:"blob",info:o.error})}};o.readAsArrayBuffer(i)}},{key:"getByteAt",value:function e(t){return this._fileData.getByteAt(t)}}],[{key:"canReadFile",value:function e(t){return typeof Blob!=="undefined"&&t instanceof Blob||typeof File!=="undefined"&&t instanceof File}}]);return t}(u);t.exports=f},{"./ChunkedFileData":5,"./MediaFileReader":11}],5:[function(e,t,r){var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||false;n.configurable=true;if("value"in n)n.writable=true;Object.defineProperty(e,n.key,n)}}return function(t,r,n){if(r)e(t.prototype,r);if(n)e(t,n);return t}}();function a(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var i=-1;var o=function(){n(e,null,[{key:"NOT_FOUND",get:function(){return i}}]);function e(){a(this,e);this._fileData=[]}n(e,[{key:"addData",value:function e(t,r){var n=t+r.length-1;var a=this._getChunkRange(t,n);if(a.startIx===i){this._fileData.splice(a.insertIx||0,0,{offset:t,data:r})}else{var o=this._fileData[a.startIx];var s=this._fileData[a.endIx];var u=t>o.offset;var f=n<s.offset+s.data.length-1;var l={offset:Math.min(t,o.offset),data:r};if(u){var c=this._sliceData(o.data,0,t-o.offset);l.data=this._concatData(c,r)}if(f){var c=this._sliceData(l.data,0,s.offset-l.offset);l.data=this._concatData(c,s.data)}this._fileData.splice(a.startIx,a.endIx-a.startIx+1,l)}}},{key:"_concatData",value:function e(t,r){if(typeof ArrayBuffer!=="undefined"&&ArrayBuffer.isView&&ArrayBuffer.isView(t)){var n=new t.constructor(t.length+r.length);n.set(t,0);n.set(r,t.length);return n}else{return t.concat(r)}}},{key:"_sliceData",value:function e(t,r,n){if(t.slice){return t.slice(r,n)}else{return t.subarray(r,n)}}},{key:"_getChunkRange",value:function e(t,r){var n=i;var a=i;var o=0;for(var s=0;s<this._fileData.length;s++,o=s){var u=this._fileData[s].offset;var f=u+this._fileData[s].data.length;if(r<u-1){break}if(t<=f+1&&r>=u-1){n=s;break}}if(n===i){return{startIx:i,endIx:i,insertIx:o}}for(var s=n;s<this._fileData.length;s++){var u=this._fileData[s].offset;var f=u+this._fileData[s].data.length;if(r>=u-1){a=s}if(r<=f+1){break}}if(a===i){a=n}return{startIx:n,endIx:a}}},{key:"hasDataRange",value:function e(t,r){for(var n=0;n<this._fileData.length;n++){var a=this._fileData[n];if(r<a.offset){return false}if(t>=a.offset&&r<a.offset+a.data.length){return true}}return false}},{key:"getByteAt",value:function e(t){var r;for(var n=0;n<this._fileData.length;n++){var a=this._fileData[n].offset;var i=a+this._fileData[n].data.length-1;if(t>=a&&t<=i){r=this._fileData[n];break}}if(r){return r.data[t-r.offset]}throw new Error("Offset "+t+" hasn't been loaded yet.")}}]);return e}();t.exports=o},{}],6:[function(e,t,r){var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||false;n.configurable=true;if("value"in n)n.writable=true;Object.defineProperty(e,n.key,n)}}return function(t,r,n){if(r)e(t.prototype,r);if(n)e(t,n);return t}}();function a(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function i(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function o(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var s=e("./MediaTagReader");var u=4;var f=[4,132];var l=[6,134];var c=["Other","32x32 pixels 'file icon' (PNG only)","Other file icon","Cover (front)","Cover (back)","Leaflet page","Media (e.g. label side of CD)","Lead artist/lead performer/soloist","Artist/performer","Conductor","Band/Orchestra","Composer","Lyricist/text writer","Recording Location","During recording","During performance","Movie/video screen capture","A bright coloured fish","Illustration","Band/artist logotype","Publisher/Studio logotype"];var d=function(e){o(t,e);function t(){a(this,t);return i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}n(t,[{key:"_loadData",value:function e(t,r){var n=this;t.loadRange([4,7],{onSuccess:function(){n._loadBlock(t,4,r)}})}},{key:"_loadBlock",value:function e(t,r,n){var a=this;var i=t.getByteAt(r);var o=t.getInteger24At(r+1,true);if(f.indexOf(i)!==-1){var s=r+4;t.loadRange([s,s+o],{onSuccess:function(){a._commentOffset=s;a._nextBlock(t,r,i,o,n)}})}else if(l.indexOf(i)!==-1){var s=r+4;t.loadRange([s,s+o],{onSuccess:function(){a._pictureOffset=s;a._nextBlock(t,r,i,o,n)}})}else{a._nextBlock(t,r,i,o,n)}}},{key:"_nextBlock",value:function e(t,r,n,a,i){var o=this;if(n>127){if(!o._commentOffset){i.onError({type:"loadData",info:"Comment block could not be found."})}else{i.onSuccess()}}else{t.loadRange([r+4+a,r+4+4+a],{onSuccess:function(){o._loadBlock(t,r+4+a,i)}})}}},{key:"_parseData",value:function e(t,r){var n=t.getLongAt(this._commentOffset,false);var a=this._commentOffset+4;var i=n+a;var o=t.getLongAt(i,false);var s=i+4;var u,f,l,d,g,v;for(var h=0;h<o;h++){var p=t.getLongAt(s,false);var y=t.getStringWithCharsetAt(s+4,p,"utf-8").toString();var m=y.indexOf("=");var b=[y.slice(0,m),y.slice(m+1)];switch(b[0]){case"TITLE":u=b[1];break;case"ARTIST":f=b[1];break;case"ALBUM":l=b[1];break;case"TRACKNUMBER":d=b[1];break;case"GENRE":g=b[1];break}s+=4+p}if(this._pictureOffset){var _=t.getLongAt(this._pictureOffset,true);var T=this._pictureOffset+4;var R=t.getLongAt(T,true);var S=T+4;var A=t.getStringAt(S,R);var k=S+R;var C=t.getLongAt(k,true);var w=k+4;var O=t.getStringWithCharsetAt(w,C,"utf-8").toString();var E=w+C+16;var P=t.getLongAt(E,true);var B=E+4;var D=t.getBytesAt(B,P,true);v={format:A,type:c[_],description:O,data:D}}var F={type:"FLAC",version:"1",tags:{title:u,artist:f,album:l,track:d,genre:g,picture:v}};return F}}],[{key:"getTagIdentifierByteRange",value:function e(){return{offset:0,length:u}}},{key:"canReadTagFormat",value:function e(t){var r=String.fromCharCode.apply(String,t.slice(0,4));return r==="fLaC"}}]);return t}(s);t.exports=d},{"./MediaTagReader":12}],7:[function(e,t,r){var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||false;n.configurable=true;if("value"in n)n.writable=true;Object.defineProperty(e,n.key,n)}}return function(t,r,n){if(r)e(t.prototype,r);if(n)e(t,n);return t}}();function a(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function i(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function o(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var s=e("./MediaTagReader");var u=e("./MediaFileReader");var f=function(e){o(t,e);function t(){a(this,t);return i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}n(t,[{key:"_loadData",value:function e(t,r){var n=t.getSize();t.loadRange([n-128,n-1],r)}},{key:"_parseData",value:function e(t,r){var n=t.getSize()-128;var a=t.getStringWithCharsetAt(n+3,30).toString();var i=t.getStringWithCharsetAt(n+33,30).toString();var o=t.getStringWithCharsetAt(n+63,30).toString();var s=t.getStringWithCharsetAt(n+93,4).toString();var u=t.getByteAt(n+97+28);var f=t.getByteAt(n+97+29);if(u==0&&f!=0){var c="1.1";var d=t.getStringWithCharsetAt(n+97,28).toString()}else{var c="1.0";var d=t.getStringWithCharsetAt(n+97,30).toString();f=0}var g=t.getByteAt(n+97+30);if(g<255){var v=l[g]}else{var v=""}var h={type:"ID3",version:c,tags:{title:a,artist:i,album:o,year:s,comment:d,genre:v}};if(f){h.tags.track=f}return h}}],[{key:"getTagIdentifierByteRange",value:function e(){return{offset:-128,length:128}}},{key:"canReadTagFormat",value:function e(t){var r=String.fromCharCode.apply(String,t.slice(0,3));return r==="TAG"}}]);return t}(s);var l=["Blues","Classic Rock","Country","Dance","Disco","Funk","Grunge","Hip-Hop","Jazz","Metal","New Age","Oldies","Other","Pop","R&B","Rap","Reggae","Rock","Techno","Industrial","Alternative","Ska","Death Metal","Pranks","Soundtrack","Euro-Techno","Ambient","Trip-Hop","Vocal","Jazz+Funk","Fusion","Trance","Classical","Instrumental","Acid","House","Game","Sound Clip","Gospel","Noise","AlternRock","Bass","Soul","Punk","Space","Meditative","Instrumental Pop","Instrumental Rock","Ethnic","Gothic","Darkwave","Techno-Industrial","Electronic","Pop-Folk","Eurodance","Dream","Southern Rock","Comedy","Cult","Gangsta","Top 40","Christian Rap","Pop/Funk","Jungle","Native American","Cabaret","New Wave","Psychadelic","Rave","Showtunes","Trailer","Lo-Fi","Tribal","Acid Punk","Acid Jazz","Polka","Retro","Musical","Rock & Roll","Hard Rock","Folk","Folk-Rock","National Folk","Swing","Fast Fusion","Bebob","Latin","Revival","Celtic","Bluegrass","Avantgarde","Gothic Rock","Progressive Rock","Psychedelic Rock","Symphonic Rock","Slow Rock","Big Band","Chorus","Easy Listening","Acoustic","Humour","Speech","Chanson","Opera","Chamber Music","Sonata","Symphony","Booty Bass","Primus","Porn Groove","Satire","Slow Jam","Club","Tango","Samba","Folklore","Ballad","Power Ballad","Rhythmic Soul","Freestyle","Duet","Punk Rock","Drum Solo","Acapella","Euro-House","Dance Hall"];t.exports=f},{"./MediaFileReader":11,"./MediaTagReader":12}],8:[function(e,t,r){var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||false;n.configurable=true;if("value"in n)n.writable=true;Object.defineProperty(e,n.key,n)}}return function(t,r,n){if(r)e(t.prototype,r);if(n)e(t,n);return t}}();function a(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var i=e("./MediaFileReader");var o=e("./StringUtils");var s=e("./ArrayFileReader");var u={BUF:"Recommended buffer size",CNT:"Play counter",COM:"Comments",CRA:"Audio encryption",CRM:"Encrypted meta frame",ETC:"Event timing codes",EQU:"Equalization",GEO:"General encapsulated object",IPL:"Involved people list",LNK:"Linked information",MCI:"Music CD Identifier",MLL:"MPEG location lookup table",PIC:"Attached picture",POP:"Popularimeter",REV:"Reverb",RVA:"Relative volume adjustment",SLT:"Synchronized lyric/text",STC:"Synced tempo codes",TAL:"Album/Movie/Show title",TBP:"BPM (Beats Per Minute)",TCM:"Composer",TCO:"Content type",TCR:"Copyright message",TDA:"Date",TDY:"Playlist delay",TEN:"Encoded by",TFT:"File type",TIM:"Time",TKE:"Initial key",TLA:"Language(s)",TLE:"Length",TMT:"Media type",TOA:"Original artist(s)/performer(s)",TOF:"Original filename",TOL:"Original Lyricist(s)/text writer(s)",TOR:"Original release year",TOT:"Original album/Movie/Show title",TP1:"Lead artist(s)/Lead performer(s)/Soloist(s)/Performing group",TP2:"Band/Orchestra/Accompaniment",TP3:"Conductor/Performer refinement",TP4:"Interpreted, remixed, or otherwise modified by",TPA:"Part of a set",TPB:"Publisher",TRC:"ISRC (International Standard Recording Code)",TRD:"Recording dates",TRK:"Track number/Position in set",TSI:"Size",TSS:"Software/hardware and settings used for encoding",TT1:"Content group description",TT2:"Title/Songname/Content description",TT3:"Subtitle/Description refinement",TXT:"Lyricist/text writer",TXX:"User defined text information frame",TYE:"Year",UFI:"Unique file identifier",ULT:"Unsychronized lyric/text transcription",WAF:"Official audio file webpage",WAR:"Official artist/performer webpage",WAS:"Official audio source webpage",WCM:"Commercial information",WCP:"Copyright/Legal information",WPB:"Publishers official webpage",WXX:"User defined URL link frame",AENC:"Audio encryption",APIC:"Attached picture",ASPI:"Audio seek point index",CHAP:"Chapter",CTOC:"Table of contents",COMM:"Comments",COMR:"Commercial frame",ENCR:"Encryption method registration",EQU2:"Equalisation (2)",EQUA:"Equalization",ETCO:"Event timing codes",GEOB:"General encapsulated object",GRID:"Group identification registration",IPLS:"Involved people list",LINK:"Linked information",MCDI:"Music CD identifier",MLLT:"MPEG location lookup table",OWNE:"Ownership frame",PRIV:"Private frame",PCNT:"Play counter",POPM:"Popularimeter",POSS:"Position synchronisation frame",RBUF:"Recommended buffer size",RVA2:"Relative volume adjustment (2)",RVAD:"Relative volume adjustment",RVRB:"Reverb",SEEK:"Seek frame",SYLT:"Synchronized lyric/text",SYTC:"Synchronized tempo codes",TALB:"Album/Movie/Show title",TBPM:"BPM (beats per minute)",TCOM:"Composer",TCON:"Content type",TCOP:"Copyright message",TDAT:"Date",TDLY:"Playlist delay",TDRC:"Recording time",TDRL:"Release time",TDTG:"Tagging time",TENC:"Encoded by",TEXT:"Lyricist/Text writer",TFLT:"File type",TIME:"Time",TIPL:"Involved people list",TIT1:"Content group description",TIT2:"Title/songname/content description",TIT3:"Subtitle/Description refinement",TKEY:"Initial key",TLAN:"Language(s)",TLEN:"Length",TMCL:"Musician credits list",TMED:"Media type",TMOO:"Mood",TOAL:"Original album/movie/show title",TOFN:"Original filename",TOLY:"Original lyricist(s)/text writer(s)",TOPE:"Original artist(s)/performer(s)",TORY:"Original release year",TOWN:"File owner/licensee",TPE1:"Lead performer(s)/Soloist(s)",TPE2:"Band/orchestra/accompaniment",TPE3:"Conductor/performer refinement",TPE4:"Interpreted, remixed, or otherwise modified by",TPOS:"Part of a set",TPRO:"Produced notice",TPUB:"Publisher",TRCK:"Track number/Position in set",TRDA:"Recording dates",TRSN:"Internet radio station name",TRSO:"Internet radio station owner",TSOA:"Album sort order",TSOP:"Performer sort order",TSOT:"Title sort order",TSIZ:"Size",TSRC:"ISRC (international standard recording code)",TSSE:"Software/Hardware and settings used for encoding",TSST:"Set subtitle",TYER:"Year",TXXX:"User defined text information frame",UFID:"Unique file identifier",USER:"Terms of use",USLT:"Unsychronized lyric/text transcription",WCOM:"Commercial information",WCOP:"Copyright/Legal information",WOAF:"Official audio file webpage",WOAR:"Official artist/performer webpage",WOAS:"Official audio source webpage",WORS:"Official internet radio station homepage",WPAY:"Payment",WPUB:"Publishers official webpage",WXXX:"User defined URL link frame"};var f=function(){function e(){a(this,e)}n(e,null,[{key:"getFrameReaderFunction",value:function e(t){if(t in l){return l[t]}else if(t[0]==="T"){return l["T*"]}else if(t[0]==="W"){return l["W*"]}else{return null}}},{key:"readFrames",value:function t(r,n,a,i,o){var s={};var u=this._getFrameHeaderSize(i);while(r<n-u){var f=this._readFrameHeader(a,r,i);var l=f.id;if(!l){break}var c=f.flags;var d=f.size;var g=r+f.headerSize;var v=a;r+=f.headerSize+f.size;if(o&&o.indexOf(l)===-1){continue}if(l==="MP3e"||l==="\0MP3"||l==="\0\0MP"||l===" MP3"){break}if(c&&c.format.unsynchronisation){v=this.getUnsyncFileReader(v,g,d);g=0;d=v.getSize()}if(c&&c.format.data_length_indicator){g+=4;d-=4}var h=e.getFrameReaderFunction(l);var p=h?h.apply(this,[g,d,v,c,i]):null;var y=this._getFrameDescription(l);var m={id:l,size:d,description:y,data:p};if(l in s){if(s[l].id){s[l]=[s[l]]}s[l].push(m)}else{s[l]=m}}return s}},{key:"_getFrameHeaderSize",value:function e(t){var r=t.major;if(r==2){return 6}else if(r==3||r==4){return 10}else{return 0}}},{key:"_readFrameHeader",value:function e(t,r,n){var a=n.major;var i=null;var o=this._getFrameHeaderSize(n);switch(a){case 2:var s=t.getStringAt(r,3);var u=t.getInteger24At(r+3,true);break;case 3:var s=t.getStringAt(r,4);var u=t.getLongAt(r+4,true);break;case 4:var s=t.getStringAt(r,4);var u=t.getSynchsafeInteger32At(r+4);break}if(s==String.fromCharCode(0,0,0)||s==String.fromCharCode(0,0,0,0)){s=""}if(s){if(a>2){i=this._readFrameFlags(t,r+8)}}return{id:s||"",size:u||0,headerSize:o||0,flags:i}}},{key:"_readFrameFlags",value:function e(t,r){return{message:{tag_alter_preservation:t.isBitSetAt(r,6),file_alter_preservation:t.isBitSetAt(r,5),read_only:t.isBitSetAt(r,4)},format:{grouping_identity:t.isBitSetAt(r+1,7),compression:t.isBitSetAt(r+1,3),encryption:t.isBitSetAt(r+1,2),unsynchronisation:t.isBitSetAt(r+1,1),data_length_indicator:t.isBitSetAt(r+1,0)}}}},{key:"_getFrameDescription",value:function e(t){if(t in u){return u[t]}else{return"Unknown"}}},{key:"getUnsyncFileReader",value:function e(t,r,n){var a=t.getBytesAt(r,n);for(var i=0;i<a.length-1;i++){if(a[i]===255&&a[i+1]===0){a.splice(i+1,1)}}return new s(a)}}]);return e}();var l={};l["APIC"]=function e(t,r,n,a,i){var o=t;var s=c(n.getByteAt(t));switch(i&&i.major){case 2:var u=n.getStringAt(t+1,3);t+=4;break;case 3:case 4:var u=n.getStringWithCharsetAt(t+1,r-1);t+=1+u.bytesReadCount;break;default:throw new Error("Couldn't read ID3v2 major version.")}var f=n.getByteAt(t);var l=g[f];var d=n.getStringWithCharsetAt(t+1,r-(t-o)-1,s);t+=1+d.bytesReadCount;return{format:u.toString(),type:l,description:d.toString(),data:n.getBytesAt(t,o+r-t)}};l["CHAP"]=function e(t,r,n,a,i){var s=t;var u={};var f=o.readNullTerminatedString(n.getBytesAt(t,r));u.id=f.toString();t+=f.bytesReadCount;u.startTime=n.getLongAt(t,true);t+=4;u.endTime=n.getLongAt(t,true);t+=4;u.startOffset=n.getLongAt(t,true);t+=4;u.endOffset=n.getLongAt(t,true);t+=4;var l=r-(t-s);u.subFrames=this.readFrames(t,t+l,n,i);return u};l["CTOC"]=function e(t,r,n,a,i){var s=t;var u={childElementIds:[],id:undefined,topLevel:undefined,ordered:undefined,entryCount:undefined,subFrames:undefined};var f=o.readNullTerminatedString(n.getBytesAt(t,r));u.id=f.toString();t+=f.bytesReadCount;u.topLevel=n.isBitSetAt(t,1);u.ordered=n.isBitSetAt(t,0);t++;u.entryCount=n.getByteAt(t);t++;for(var l=0;l<u.entryCount;l++){var c=o.readNullTerminatedString(n.getBytesAt(t,r-(t-s)));u.childElementIds.push(c.toString());t+=c.bytesReadCount}var d=r-(t-s);u.subFrames=this.readFrames(t,t+d,n,i);return u};l["COMM"]=function e(t,r,n,a,i){var o=t;var s=c(n.getByteAt(t));var u=n.getStringAt(t+1,3);var f=n.getStringWithCharsetAt(t+4,r-4,s);t+=4+f.bytesReadCount;var l=n.getStringWithCharsetAt(t,o+r-t,s);return{language:u,short_description:f.toString(),text:l.toString()}};l["COM"]=l["COMM"];l["PIC"]=function(e,t,r,n,a){return l["APIC"](e,t,r,n,a)};l["PCNT"]=function e(t,r,n,a,i){return n.getLongAt(t,false)};l["CNT"]=l["PCNT"];l["T*"]=function e(t,r,n,a,i){var o=c(n.getByteAt(t));return n.getStringWithCharsetAt(t+1,r-1,o).toString()};l["TXXX"]=function e(t,r,n,a,i){var o=c(n.getByteAt(t));return d(t,r,n,o)};l["WXXX"]=function e(t,r,n,a,i){if(r===0){return null}var o=c(n.getByteAt(t));return d(t,r,n,o)};l["W*"]=function e(t,r,n,a,i){if(r===0){return null}return n.getStringWithCharsetAt(t,r,"iso-8859-1").toString()};l["TCON"]=function e(t,r,n,a){var i=l["T*"].apply(this,arguments);return i.replace(/^\(\d+\)/,"")};l["TCO"]=l["TCON"];l["USLT"]=function e(t,r,n,a,i){var o=t;var s=c(n.getByteAt(t));var u=n.getStringAt(t+1,3);var f=n.getStringWithCharsetAt(t+4,r-4,s);t+=4+f.bytesReadCount;var l=n.getStringWithCharsetAt(t,o+r-t,s);return{language:u,descriptor:f.toString(),lyrics:l.toString()}};l["ULT"]=l["USLT"];l["UFID"]=function e(t,r,n,a,i){var s=o.readNullTerminatedString(n.getBytesAt(t,r));t+=s.bytesReadCount;var u=n.getBytesAt(t,r-s.bytesReadCount);return{ownerIdentifier:s.toString(),identifier:u}};function c(e){var t;switch(e){case 0:t="iso-8859-1";break;case 1:t="utf-16";break;case 2:t="utf-16be";break;case 3:t="utf-8";break;default:t="iso-8859-1"}return t}function d(e,t,r,n){var a=r.getStringWithCharsetAt(e+1,t-1,n);var i=r.getStringWithCharsetAt(e+1+a.bytesReadCount,t-1-a.bytesReadCount);return{user_description:a.toString(),data:i.toString()}}var g=["Other","32x32 pixels 'file icon' (PNG only)","Other file icon","Cover (front)","Cover (back)","Leaflet page","Media (e.g. label side of CD)","Lead artist/lead performer/soloist","Artist/performer","Conductor","Band/Orchestra","Composer","Lyricist/text writer","Recording Location","During recording","During performance","Movie/video screen capture","A bright coloured fish","Illustration","Band/artist logotype","Publisher/Studio logotype"];t.exports=f},{"./ArrayFileReader":3,"./MediaFileReader":11,"./StringUtils":13}],9:[function(e,t,r){var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||false;n.configurable=true;if("value"in n)n.writable=true;Object.defineProperty(e,n.key,n)}}return function(t,r,n){if(r)e(t.prototype,r);if(n)e(t,n);return t}}();function a(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function i(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function o(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var s=e("./MediaTagReader");var u=e("./MediaFileReader");var f=e("./ID3v2FrameReader");var l=10;var c=function(e){o(t,e);function t(){a(this,t);return i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}n(t,[{key:"_loadData",value:function e(t,r){t.loadRange([6,9],{onSuccess:function(){t.loadRange([0,l+t.getSynchsafeInteger32At(6)-1],r)},onError:r.onError})}},{key:"_parseData",value:function e(t,r){var n=0;var a=t.getByteAt(n+3);if(a>4){return{type:"ID3",version:">2.4",tags:{}}}var i=t.getByteAt(n+4);var o=t.isBitSetAt(n+5,7);var s=t.isBitSetAt(n+5,6);var u=t.isBitSetAt(n+5,5);var l=t.getSynchsafeInteger32At(n+6);n+=10;if(s){var c=t.getLongAt(n,true);n+=c+4}var g={type:"ID3",version:"2."+a+"."+i,major:a,revision:i,flags:{unsynchronisation:o,extended_header:s,experimental_indicator:u,footer_present:false},size:l,tags:{}};if(r){var v=this._expandShortcutTags(r)}var h=l+10;if(g.flags.unsynchronisation){t=f.getUnsyncFileReader(t,n,l);n=0;h=t.getSize()}var p=f.readFrames(n,h,t,g,v);for(var y in d){if(d.hasOwnProperty(y)){var m=this._getFrameData(p,d[y]);if(m){g.tags[y]=m}}}for(var b in p){if(p.hasOwnProperty(b)){g.tags[b]=p[b]}}return g}},{key:"_getFrameData",value:function e(t,r){var n;for(var a=0,i;i=r[a];a++){if(i in t){if(t[i]instanceof Array){n=t[i][0]}else{n=t[i]}return n.data}}}},{key:"getShortcuts",value:function e(){return d}}],[{key:"getTagIdentifierByteRange",value:function e(){return{offset:0,length:l}}},{key:"canReadTagFormat",value:function e(t){var r=String.fromCharCode.apply(String,t.slice(0,3));return r==="ID3"}}]);return t}(s);var d={title:["TIT2","TT2"],artist:["TPE1","TP1"],album:["TALB","TAL"],year:["TYER","TYE"],comment:["COMM","COM"],track:["TRCK","TRK"],genre:["TCON","TCO"],picture:["APIC","PIC"],lyrics:["USLT","ULT"]};t.exports=c},{"./ID3v2FrameReader":8,"./MediaFileReader":11,"./MediaTagReader":12}],10:[function(e,t,r){var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||false;n.configurable=true;if("value"in n)n.writable=true;Object.defineProperty(e,n.key,n)}}return function(t,r,n){if(r)e(t.prototype,r);if(n)e(t,n);return t}}();function a(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function i(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function o(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var s=e("./MediaTagReader");var u=e("./MediaFileReader");var f=function(e){o(t,e);function t(){a(this,t);return i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}n(t,[{key:"_loadData",value:function e(t,r){var n=this;t.loadRange([0,16],{onSuccess:function(){n._loadAtom(t,0,"",r)},onError:r.onError})}},{key:"_loadAtom",value:function e(t,r,n,a){if(r>=t.getSize()){a.onSuccess();return}var i=this;var o=t.getLongAt(r,true);if(o==0||isNaN(o)){a.onSuccess();return}var s=t.getStringAt(r+4,4);if(this._isContainerAtom(s)){if(s=="meta"){r+=4}var u=(n?n+".":"")+s;if(u==="moov.udta.meta.ilst"){t.loadRange([r,r+o],a)}else{t.loadRange([r+8,r+8+8],{onSuccess:function(){i._loadAtom(t,r+8,u,a)},onError:a.onError})}}else{t.loadRange([r+o,r+o+8],{onSuccess:function(){i._loadAtom(t,r+o,n,a)},onError:a.onError})}}},{key:"_isContainerAtom",value:function e(t){return["moov","udta","meta","ilst"].indexOf(t)>=0}},{key:"_canReadAtom",value:function e(t){return t!=="----"}},{key:"_parseData",value:function e(t,r){var n={};r=this._expandShortcutTags(r);this._readAtom(n,t,0,t.getSize(),r);for(var a in d){if(d.hasOwnProperty(a)){var i=n[d[a]];if(i){if(a==="track"){n[a]=i.data.track}else{n[a]=i.data}}}}return{type:"MP4",ftyp:t.getStringAt(8,4),version:t.getLongAt(12,true),tags:n}}},{key:"_readAtom",value:function e(t,r,n,a,i,o,s){s=s===undefined?"":s+"  ";var u=n;while(u<n+a){var f=r.getLongAt(u,true);if(f==0){return}var l=r.getStringAt(u+4,4);if(this._isContainerAtom(l)){if(l=="meta"){u+=4}var c=(o?o+".":"")+l;this._readAtom(t,r,u+8,f-8,i,c,s);return}if((!i||i.indexOf(l)>=0)&&o==="moov.udta.meta.ilst"&&this._canReadAtom(l)){t[l]=this._readMetadataAtom(r,u)}u+=f}}},{key:"_readMetadataAtom",value:function e(t,r){var n=16;var a=t.getLongAt(r,true);var i=t.getStringAt(r+4,4);var o=t.getInteger24At(r+n+1,true);var s=l[o];var u;if(i=="trkn"){u={track:t.getByteAt(r+n+11),total:t.getByteAt(r+n+13)}}else if(i=="disk"){u={disk:t.getByteAt(r+n+11),total:t.getByteAt(r+n+13)}}else{var f=n+4+4;var d=r+f;var g=a-f;var u;if(i==="covr"&&s==="uint8"){s="jpeg"}switch(s){case"text":u=t.getStringWithCharsetAt(d,g,"utf-8").toString();break;case"uint8":u=t.getShortAt(d,false);break;case"int":case"uint":var v=s=="int"?g==1?t.getSByteAt:g==2?t.getSShortAt:g==4?t.getSLongAt:t.getLongAt:g==1?t.getByteAt:g==2?t.getShortAt:t.getLongAt;u=v.call(t,d+(g==8?4:0),true);break;case"jpeg":case"png":u={format:"image/"+s,data:t.getBytesAt(d,g)};break}}return{id:i,size:a,description:c[i]||"Unknown",data:u}}},{key:"getShortcuts",value:function e(){return d}}],[{key:"getTagIdentifierByteRange",value:function e(){return{offset:0,length:16}}},{key:"canReadTagFormat",value:function e(t){var r=String.fromCharCode.apply(String,t.slice(4,8));return r==="ftyp"}}]);return t}(s);var l={0:"uint8",1:"text",13:"jpeg",14:"png",21:"int",22:"uint"};var c={"©alb":"Album","©ART":"Artist",aART:"Album Artist","©day":"Release Date","©nam":"Title","©gen":"Genre",gnre:"Genre",trkn:"Track Number","©wrt":"Composer","©too":"Encoding Tool","©enc":"Encoded By",cprt:"Copyright",covr:"Cover Art","©grp":"Grouping",keyw:"Keywords","©lyr":"Lyrics","©cmt":"Comment",tmpo:"Tempo",cpil:"Compilation",disk:"Disc Number",tvsh:"TV Show Name",tven:"TV Episode ID",tvsn:"TV Season",tves:"TV Episode",tvnn:"TV Network",desc:"Description",ldes:"Long Description",sonm:"Sort Name",soar:"Sort Artist",soaa:"Sort Album",soco:"Sort Composer",sosn:"Sort Show",purd:"Purchase Date",pcst:"Podcast",purl:"Podcast URL",catg:"Category",hdvd:"HD Video",stik:"Media Type",rtng:"Content Rating",pgap:"Gapless Playback",apID:"Purchase Account",sfID:"Country Code",atID:"Artist ID",cnID:"Catalog ID",plID:"Collection ID",geID:"Genre ID","xid ":"Vendor Information",flvr:"Codec Flavor"};var d={title:"©nam",artist:"©ART",album:"©alb",year:"©day",comment:"©cmt",track:"trkn",genre:"©gen",picture:"covr",lyrics:"©lyr"};t.exports=f},{"./MediaFileReader":11,"./MediaTagReader":12}],11:[function(e,t,r){var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||false;n.configurable=true;if("value"in n)n.writable=true;Object.defineProperty(e,n.key,n)}}return function(t,r,n){if(r)e(t.prototype,r);if(n)e(t,n);return t}}();function a(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var i=e("./StringUtils");var o=function(){function e(t){a(this,e);this._isInitialized=false;this._size=0}n(e,[{key:"init",value:function e(t){var r=this;if(this._isInitialized){setTimeout(t.onSuccess,1)}else{return this._init({onSuccess:function(){r._isInitialized=true;t.onSuccess()},onError:t.onError})}}},{key:"_init",value:function e(t){throw new Error("Must implement init function")}},{key:"loadRange",value:function e(t,r){throw new Error("Must implement loadRange function")}},{key:"getSize",value:function e(){if(!this._isInitialized){throw new Error("init() must be called first.")}return this._size}},{key:"getByteAt",value:function e(t){throw new Error("Must implement getByteAt function")}},{key:"getBytesAt",value:function e(t,r){var n=new Array(r);for(var a=0;a<r;a++){n[a]=this.getByteAt(t+a)}return n}},{key:"isBitSetAt",value:function e(t,r){var n=this.getByteAt(t);return(n&1<<r)!=0}},{key:"getSByteAt",value:function e(t){var r=this.getByteAt(t);if(r>127){return r-256}else{return r}}},{key:"getShortAt",value:function e(t,r){var n=r?(this.getByteAt(t)<<8)+this.getByteAt(t+1):(this.getByteAt(t+1)<<8)+this.getByteAt(t);if(n<0){n+=65536}return n}},{key:"getSShortAt",value:function e(t,r){var n=this.getShortAt(t,r);if(n>32767){return n-65536}else{return n}}},{key:"getLongAt",value:function e(t,r){var n=this.getByteAt(t),a=this.getByteAt(t+1),i=this.getByteAt(t+2),o=this.getByteAt(t+3);var s=r?(((n<<8)+a<<8)+i<<8)+o:(((o<<8)+i<<8)+a<<8)+n;if(s<0){s+=4294967296}return s}},{key:"getSLongAt",value:function e(t,r){var n=this.getLongAt(t,r);if(n>2147483647){return n-4294967296}else{return n}}},{key:"getInteger24At",value:function e(t,r){var n=this.getByteAt(t),a=this.getByteAt(t+1),i=this.getByteAt(t+2);var o=r?((n<<8)+a<<8)+i:((i<<8)+a<<8)+n;if(o<0){o+=16777216}return o}},{key:"getStringAt",value:function e(t,r){var n=[];for(var a=t,i=0;a<t+r;a++,i++){n[i]=String.fromCharCode(this.getByteAt(a))}return n.join("")}},{key:"getStringWithCharsetAt",value:function e(t,r,n){var a=this.getBytesAt(t,r);var o;switch((n||"").toLowerCase()){case"utf-16":case"utf-16le":case"utf-16be":o=i.readUTF16String(a,n==="utf-16be");break;case"utf-8":o=i.readUTF8String(a);break;default:o=i.readNullTerminatedString(a);break}return o}},{key:"getCharAt",value:function e(t){return String.fromCharCode(this.getByteAt(t))}},{key:"getSynchsafeInteger32At",value:function e(t){var r=this.getByteAt(t);var n=this.getByteAt(t+1);var a=this.getByteAt(t+2);var i=this.getByteAt(t+3);var o=i&127|(a&127)<<7|(n&127)<<14|(r&127)<<21;return o}}],[{key:"canReadFile",value:function e(t){throw new Error("Must implement canReadFile function")}}]);return e}();t.exports=o},{"./StringUtils":13}],12:[function(e,t,r){var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||false;n.configurable=true;if("value"in n)n.writable=true;Object.defineProperty(e,n.key,n)}}return function(t,r,n){if(r)e(t.prototype,r);if(n)e(t,n);return t}}();function a(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var i=e("./MediaFileReader");var o=function(){function e(t){a(this,e);this._mediaFileReader=t;this._tags=null}n(e,[{key:"setTagsToRead",value:function e(t){this._tags=t;return this}},{key:"read",value:function e(t){var r=this;this._mediaFileReader.init({onSuccess:function(){r._loadData(r._mediaFileReader,{onSuccess:function(){try{var e=r._parseData(r._mediaFileReader,r._tags)}catch(e){if(t.onError){t.onError({type:"parseData",info:e.message});return}}t.onSuccess(e)},onError:t.onError})},onError:t.onError})}},{key:"getShortcuts",value:function e(){return{}}},{key:"_loadData",value:function e(t,r){throw new Error("Must implement _loadData function")}},{key:"_parseData",value:function e(t,r){throw new Error("Must implement _parseData function")}},{key:"_expandShortcutTags",value:function e(t){if(!t){return null}var r=[];var n=this.getShortcuts();for(var a=0,i;i=t[a];a++){r=r.concat(n[i]||[i])}return r}}],[{key:"getTagIdentifierByteRange",value:function e(){throw new Error("Must implement")}},{key:"canReadTagFormat",value:function e(t){throw new Error("Must implement")}}]);return e}();t.exports=o},{"./MediaFileReader":11}],13:[function(e,t,r){var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||false;n.configurable=true;if("value"in n)n.writable=true;Object.defineProperty(e,n.key,n)}}return function(t,r,n){if(r)e(t.prototype,r);if(n)e(t,n);return t}}();function a(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var i=function(){function e(t,r){a(this,e);this._value=t;this.bytesReadCount=r;this.length=t.length}n(e,[{key:"toString",value:function e(){return this._value}}]);return e}();var o={readUTF16String:function(e,t,r){var n=0;var a=1,o=0;r=Math.min(r||e.length,e.length);if(e[0]==254&&e[1]==255){t=true;n=2}else if(e[0]==255&&e[1]==254){t=false;n=2}if(t){a=0;o=1}var s=[];for(var u=0;n<r;u++){var f=e[n+a];var l=e[n+o];var c=(f<<8)+l;n+=2;if(c==0){break}else if(f<216||f>=224){s[u]=String.fromCharCode(c)}else{var d=e[n+a];var g=e[n+o];var v=(d<<8)+g;n+=2;s[u]=String.fromCharCode(c,v)}}return new i(s.join(""),n)},readUTF8String:function(e,t){var r=0;t=Math.min(t||e.length,e.length);if(e[0]==239&&e[1]==187&&e[2]==191){r=3}var n=[];for(var a=0;r<t;a++){var o=e[r++];if(o==0){break}else if(o<128){n[a]=String.fromCharCode(o)}else if(o>=194&&o<224){var s=e[r++];n[a]=String.fromCharCode(((o&31)<<6)+(s&63))}else if(o>=224&&o<240){var s=e[r++];var u=e[r++];n[a]=String.fromCharCode(((o&255)<<12)+((s&63)<<6)+(u&63))}else if(o>=240&&o<245){var s=e[r++];var u=e[r++];var f=e[r++];var l=((o&7)<<18)+((s&63)<<12)+((u&63)<<6)+(f&63)-65536;n[a]=String.fromCharCode((l>>10)+55296,(l&1023)+56320)}}return new i(n.join(""),r)},readNullTerminatedString:function(e,t){var r=[];t=t||e.length;for(var n=0;n<t;){var a=e[n++];if(a==0){break}r[n-1]=String.fromCharCode(a)}return new i(r.join(""),n)}};t.exports=o},{}],14:[function(e,t,r){var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||false;n.configurable=true;if("value"in n)n.writable=true;Object.defineProperty(e,n.key,n)}}return function(t,r,n){if(r)e(t.prototype,r);if(n)e(t,n);return t}}();function a(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function i(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function o(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var s=e("./ChunkedFileData");var u=e("./MediaFileReader");var f=1024;var l=function(t){o(r,t);function r(e){a(this,r);var t=i(this,(r.__proto__||Object.getPrototypeOf(r)).call(this));t._url=e;t._fileData=new s;return t}n(r,[{key:"_init",value:function e(t){if(r._config.avoidHeadRequests){this._fetchSizeWithGetRequest(t)}else{this._fetchSizeWithHeadRequest(t)}}},{key:"_fetchSizeWithHeadRequest",value:function e(t){var r=this;this._makeXHRRequest("HEAD",null,{onSuccess:function(e){var n=r._parseContentLength(e);if(n){r._size=n;t.onSuccess()}else{r._fetchSizeWithGetRequest(t)}},onError:t.onError})}},{key:"_fetchSizeWithGetRequest",value:function e(t){var r=this;var n=this._roundRangeToChunkMultiple([0,0]);this._makeXHRRequest("GET",n,{onSuccess:function(e){var n=r._parseContentRange(e);var a=r._getXhrResponseContent(e);if(n){if(n.instanceLength==null){r._fetchEntireFile(t);return}r._size=n.instanceLength}else{r._size=a.length}r._fileData.addData(0,a);t.onSuccess()},onError:t.onError})}},{key:"_fetchEntireFile",value:function e(t){var r=this;this._makeXHRRequest("GET",null,{onSuccess:function(e){var n=r._getXhrResponseContent(e);r._size=n.length;r._fileData.addData(0,n);t.onSuccess()},onError:t.onError})}},{key:"_getXhrResponseContent",value:function e(t){return t.responseBody||t.responseText||""}},{key:"_parseContentLength",value:function e(t){var r=this._getResponseHeader(t,"Content-Length");if(r==null){return r}else{return parseInt(r,10)}}},{key:"_parseContentRange",value:function e(t){var r=this._getResponseHeader(t,"Content-Range");if(r){var n=r.match(/bytes (\d+)-(\d+)\/(?:(\d+)|\*)/i);if(!n){throw new Error("FIXME: Unknown Content-Range syntax: "+r)}return{firstBytePosition:parseInt(n[1],10),lastBytePosition:parseInt(n[2],10),instanceLength:n[3]?parseInt(n[3],10):null}}else{return null}}},{key:"loadRange",value:function e(t,r){var n=this;if(n._fileData.hasDataRange(t[0],Math.min(n._size,t[1]))){setTimeout(r.onSuccess,1);return}t=this._roundRangeToChunkMultiple(t);t[1]=Math.min(n._size,t[1]);this._makeXHRRequest("GET",t,{onSuccess:function(e){var a=n._getXhrResponseContent(e);n._fileData.addData(t[0],a);r.onSuccess()},onError:r.onError})}},{key:"_roundRangeToChunkMultiple",value:function e(t){var r=t[1]-t[0]+1;var n=Math.ceil(r/f)*f;return[t[0],t[0]+n-1]}},{key:"_makeXHRRequest",value:function e(t,n,a){var i=this._createXHRObject();i.open(t,this._url);var o=function(){if(i.status===200||i.status===206){a.onSuccess(i)}else if(a.onError){a.onError({type:"xhr",info:"Unexpected HTTP status "+i.status+".",xhr:i})}i=null};if(typeof i.onload!=="undefined"){i.onload=o;i.onerror=function(){if(a.onError){a.onError({type:"xhr",info:"Generic XHR error, check xhr object.",xhr:i})}}}else{i.onreadystatechange=function(){if(i.readyState===4){o()}}}if(r._config.timeoutInSec){i.timeout=r._config.timeoutInSec*1e3;i.ontimeout=function(){if(a.onError){a.onError({type:"xhr",info:"Timeout after "+i.timeout/1e3+"s. Use jsmediatags.Config.setXhrTimeout to override.",xhr:i})}}}i.overrideMimeType("text/plain; charset=x-user-defined");if(n){this._setRequestHeader(i,"Range","bytes="+n[0]+"-"+n[1])}this._setRequestHeader(i,"If-Modified-Since","Sat, 01 Jan 1970 00:00:00 GMT");i.send(null)}},{key:"_setRequestHeader",value:function e(t,n,a){if(r._config.disallowedXhrHeaders.indexOf(n.toLowerCase())<0){t.setRequestHeader(n,a)}}},{key:"_hasResponseHeader",value:function e(t,r){var n=t.getAllResponseHeaders();if(!n){return false}var a=n.split("\r\n");var i=[];for(var o=0;o<a.length;o++){i[o]=a[o].split(":")[0].toLowerCase()}return i.indexOf(r.toLowerCase())>=0}},{key:"_getResponseHeader",value:function e(t,r){if(!this._hasResponseHeader(t,r)){return null}return t.getResponseHeader(r)}},{key:"getByteAt",value:function e(t){var r=this._fileData.getByteAt(t);return r.charCodeAt(0)&255}},{key:"_isWebWorker",value:function e(){return typeof WorkerGlobalScope!=="undefined"&&self instanceof WorkerGlobalScope}},{key:"_createXHRObject",value:function t(){if(typeof window==="undefined"&&!this._isWebWorker()){return new(e("xhr2").XMLHttpRequest)}if(typeof XMLHttpRequest!=="undefined"){return new XMLHttpRequest}throw new Error("XMLHttpRequest is not supported")}}],[{key:"canReadFile",value:function e(t){return typeof t==="string"&&/^[a-z]+:\/\//i.test(t)}},{key:"setConfig",value:function e(t){for(var r in t){if(t.hasOwnProperty(r)){this._config[r]=t[r]}}var n=this._config.disallowedXhrHeaders;for(var a=0;a<n.length;a++){n[a]=n[a].toLowerCase()}}}]);return r}(u);l._config={avoidHeadRequests:false,disallowedXhrHeaders:[],timeoutInSec:30};t.exports=l},{"./ChunkedFileData":5,"./MediaFileReader":11,xhr2:2}],15:[function(e,t,r){var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||false;n.configurable=true;if("value"in n)n.writable=true;Object.defineProperty(e,n.key,n)}}return function(t,r,n){if(r)e(t.prototype,r);if(n)e(t,n);return t}}();function a(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var i=e("./MediaFileReader");var o=e("./NodeFileReader");var s=e("./XhrFileReader");var u=e("./BlobFileReader");var f=e("./ArrayFileReader");var l=e("./MediaTagReader");var c=e("./ID3v1TagReader");var d=e("./ID3v2TagReader");var g=e("./MP4TagReader");var v=e("./FLACTagReader");var h=[];var p=[];function y(e,t){new b(e).read(t)}function m(e,t){var r=e.offset>=0&&e.offset+e.length>=t;var n=e.offset<0&&(-e.offset>t||e.offset+e.length>0);return!(r||n)}var b=function(){function e(t){a(this,e);this._file=t}n(e,[{key:"setTagsToRead",value:function e(t){this._tagsToRead=t;return this}},{key:"setFileReader",value:function e(t){this._fileReader=t;return this}},{key:"setTagReader",value:function e(t){this._tagReader=t;return this}},{key:"read",value:function e(t){var r=this._getFileReader();var n=new r(this._file);var a=this;n.init({onSuccess:function(){a._getTagReader(n,{onSuccess:function(e){new e(n).setTagsToRead(a._tagsToRead).read(t)},onError:t.onError})},onError:t.onError})}},{key:"_getFileReader",value:function e(){if(this._fileReader){return this._fileReader}else{return this._findFileReader()}}},{key:"_findFileReader",value:function e(){for(var t=0;t<h.length;t++){if(h[t].canReadFile(this._file)){return h[t]}}throw new Error("No suitable file reader found for "+this._file)}},{key:"_getTagReader",value:function e(t,r){if(this._tagReader){var n=this._tagReader;setTimeout(function(){r.onSuccess(n)},1)}else{this._findTagReader(t,r)}}},{key:"_findTagReader",value:function e(t,r){var n=[];var a=[];var i=t.getSize();for(var o=0;o<p.length;o++){var s=p[o].getTagIdentifierByteRange();if(!m(s,i)){continue}if(s.offset>=0&&s.offset<i/2||s.offset<0&&s.offset<-i/2){n.push(p[o])}else{a.push(p[o])}}var u=false;var f={onSuccess:function(){if(!u){u=true;return}for(var e=0;e<p.length;e++){var n=p[e].getTagIdentifierByteRange();if(!m(n,i)){continue}try{var a=t.getBytesAt(n.offset>=0?n.offset:n.offset+i,n.length)}catch(e){if(r.onError){r.onError({type:"fileReader",info:e.message})}return}if(p[e].canReadTagFormat(a)){r.onSuccess(p[e]);return}}if(r.onError){r.onError({type:"tagFormat",info:"No suitable tag reader found"})}},onError:r.onError};this._loadTagIdentifierRanges(t,n,f);this._loadTagIdentifierRanges(t,a,f)}},{key:"_loadTagIdentifierRanges",value:function e(t,r,n){if(r.length===0){setTimeout(n.onSuccess,1);return}var a=[Number.MAX_VALUE,0];var i=t.getSize();for(var o=0;o<r.length;o++){var s=r[o].getTagIdentifierByteRange();var u=s.offset>=0?s.offset:s.offset+i;var f=u+s.length-1;a[0]=Math.min(u,a[0]);a[1]=Math.max(f,a[1])}t.loadRange(a,n)}}]);return e}();var _=function(){function e(){a(this,e)}n(e,null,[{key:"addFileReader",value:function t(r){h.push(r);return e}},{key:"addTagReader",value:function t(r){p.push(r);return e}},{key:"removeTagReader",value:function t(r){var n=p.indexOf(r);if(n>=0){p.splice(n,1)}return e}},{key:"EXPERIMENTAL_avoidHeadRequests",value:function e(){s.setConfig({avoidHeadRequests:true})}},{key:"setDisallowedXhrHeaders",value:function e(t){s.setConfig({disallowedXhrHeaders:t})}},{key:"setXhrTimeoutInSec",value:function e(t){s.setConfig({timeoutInSec:t})}}]);return e}();_.addFileReader(s).addFileReader(u).addFileReader(f).addTagReader(d).addTagReader(c).addTagReader(g).addTagReader(v);if(typeof process!=="undefined"&&!process.browser){_.addFileReader(o)}t.exports={read:y,Reader:b,Config:_}},{"./ArrayFileReader":3,"./BlobFileReader":4,"./FLACTagReader":6,"./ID3v1TagReader":7,"./ID3v2TagReader":9,"./MP4TagReader":10,"./MediaFileReader":11,"./MediaTagReader":12,"./NodeFileReader":1,"./XhrFileReader":14}]},{},[15])(15)})});var u=function(){var e={};e.promise=new Promise(function(t,r){e.resolve=t;e.reject=r});return e};var c=1;function d(e){var t=e;return new Promise(function(r,n){var a=window.indexedDB.open(e,c);a.onupgradeneeded=function(){return a.result.createObjectStore(t)};a.onblocked=function(){return n(new Error("onblocked"))};a.onerror=function(){return n(a.error)};a.onsuccess=function(){var e=a.result;r(function(r,n){return g({db:e,storeName:t,transactionType:r,fn:n})})}})}function g(e){var t=e.db,r=e.storeName,n=e.transactionType,a=e.fn;return new Promise(function(e,i){var o=t.transaction(r,n);var s=o.objectStore(r);var u=a(s);var f=Array.isArray(u)?Promise.all(u.map(v)):v(u);o.onerror=function(){return i(o.error)};o.oncomplete=function(){return e(f)}})}function v(e){var t=u();e.onerror=function(r){if(typeof r.preventDefault==="function"){r.preventDefault()}t.reject(e.error)};e.onsuccess=function(){return t.resolve(e.result)};return t.promise}var h=function(){function e(e){r(this,e);this._index=0;this.songChanged=n(this,"songChanged",7);this.loaded=n(this,"loaded",7)}Object.defineProperty(e.prototype,"url",{get:function(){if(this.src.startsWith("http")){return this.src}else if(this.src.startsWith(".")){return window.location.origin+f(this.src)}else{return window.location.origin+this.src}},enumerable:true,configurable:true});e.prototype.componentWillLoad=function(){return __awaiter(this,void 0,void 0,function(){var e=this;return __generator(this,function(t){this.player=this.element.closest("stellar-playlist");if(this.player.load){this.load()}this.player.addEventListener("load_songs",function(){e.load()});return[2]})})};e.prototype.componentDidLoad=function(){};e.prototype.songChangedHandler=function(){this.songChanged.emit(this._index)};e.prototype.updateDetails=function(e){this.title=e.title;this.album=e.album;this.genre=e.genre;this.artist=e.artist;this.picture=e.picture};e.prototype.load=function(){return __awaiter(this,void 0,void 0,function(){var e,r,n,a;var i=this;return __generator(this,function(o){switch(o.label){case 0:return[4,d("songs")];case 1:e=o.sent();return[4,e("readonly",function(e){return e.get(i.src)})];case 2:r=o.sent();if(!!r)return[3,3];t.read(this.url,{onSuccess:function(t){return __awaiter(i,void 0,void 0,function(){var r,n,a,i;var o=this;return __generator(this,function(s){switch(s.label){case 0:r={title:t.tags.title,album:t.tags.album,genre:t.tags.genre,artist:t.tags.artist,picture:t.tags.picture};if(!t.tags.picture)return[3,2];n="";for(a=0;a<t.tags.picture.data.length;a++){n+=String.fromCharCode(t.tags.picture.data[a])}i="data:image/jpeg;base64,"+window.btoa(n);r.picture=i;return[4,e("readwrite",function(e){return e.put(i,r.album+"_picture")})];case 1:s.sent();return[3,3];case 2:r.picture=undefined;s.label=3;case 3:return[4,e("readwrite",function(e){return e.put(JSON.stringify(r),o.src)})];case 4:s.sent();this.updateDetails(r);return[2]}})})},onError:function(e){console.log(e);i.error=e}});return[3,5];case 3:n=JSON.parse(r);return[4,e("readonly",function(e){return e.get(n.album+"_picture")})];case 4:a=o.sent();n.picture=a;this.updateDetails(n);o.label=5;case 5:this.loaded.emit({el:this.element});return[2]}})})};e.prototype.details=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,{title:this.title,album:this.album,genre:this.genre,artist:this.artist,picture:this.picture}]})})};e.prototype.preload=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){e=new Audio;e.src=this.src;e.preload="auto";e.volume=1;return[2]})})};e.prototype.play=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){if(!this.playing){this.songChangedHandler();this.playing=true;this.player.prepare(this.element);this.player.play()}return[2]})})};e.prototype.switching=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){this.playing=false;return[2]})})};e.prototype.getIndex=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,this._index]})})};e.prototype.setIndex=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){this._index=e;return[2]})})};e.prototype.render=function(){var e=this;return a("button",{onClick:function(){return e.play()}},a("span",{class:"index"},!this.playing&&l(this._index),this.playing&&a("stellar-asset",{name:"play"})),a("div",{class:"tracklisting"},this.artwork&&a("img",{src:this.picture,class:"preview-image"}),a("h2",null,a("span",null,this.title||"Loading...")," / ",this.artist||"Loading...")),a("img",{src:this.picture,class:"backdrop"}))};Object.defineProperty(e,"assetsDirs",{get:function(){return["vendor"]},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"element",{get:function(){return i(this)},enumerable:true,configurable:true});Object.defineProperty(e,"style",{get:function(){return":host{display:block;width:100%;-ms-flex:0 0 100%;flex:0 0 100%}:host button{background:none;width:100%;border:0;outline:0;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-ms-flexbox;display:flex;padding:0;-ms-flex-align:center;align-items:center;-ms-flex-pack:start;justify-content:flex-start;position:relative;overflow:hidden;border-top:1px solid var(--color-line)}:host button:focus,:host button:hover{background:var(--color-bg-active)}:host([playing]) button{background:var(--color-bg-playing)!important}:host .index{display:-ms-flexbox;display:flex;-ms-flex-align:center;align-items:center;-ms-flex-pack:center;justify-content:center;height:45px;width:55px;-ms-flex:0 0 55px;flex:0 0 55px;border-right:1px solid var(--color-line);font-size:.75rem;margin:0;margin-right:20px;text-transform:uppercase;color:var(--color-two);letter-spacing:.23em;z-index:1;font-weight:900}:host([playing]) .index{font-size:1.5rem}:host img.preview-image{width:2rem;height:2rem;display:inline-block;margin-right:10px;-webkit-transition:all .15s ease-in-out 0s;transition:all .15s ease-in-out 0s;-webkit-filter:grayscale(100%);filter:grayscale(100%);padding:0;background:#fff;border-radius:4px;z-index:1}:host([playing]) img.preview-image{-webkit-filter:grayscale(0);filter:grayscale(0)}:host h2{z-index:1;color:var(--color-four);font-size:14px;font-weight:400;margin:0;line-height:1;margin-top:-3px;white-space:nowrap}:host h2 span{color:var(--color-two)}:host .tracklisting{overflow:auto;display:-ms-flexbox;display:flex;-ms-flex-align:center;align-items:center;width:100%;height:46px}:host .tracklisting:after{content:\"\";display:block;width:30px;height:30px;-ms-flex:0 0 30px;flex:0 0 30px}:host img.backdrop{position:absolute;width:100%;-webkit-filter:blur(20px) grayscale(75%);filter:blur(20px) grayscale(75%);opacity:.15;z-index:0;mix-blend-mode:color}:host button[data-playing=true] img.preview-image{width:30px;height:30px;-webkit-filter:grayscale(0);filter:grayscale(0)}:host button[data-playing=true] img.backdrop{opacity:1}:host button[data-playing=true] .index,:host button[data-playing=true] h2 span{color:var(--color-three)!important}"},enumerable:true,configurable:true});return e}();e("stellar_song",h)}}});