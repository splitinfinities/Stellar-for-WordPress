import{c as t,e as o,d as e}from"./p-9ed7c17e.js";import{b as n,c as s,d as i,e as a,f as r,g as c,h as l,i as h,j as d}from"./p-2c7f64d5.js";import{b as u,c as f,d as p,e as w,f as y,g,h as m,i as P,j as b}from"./p-de300708.js";import{a as T}from"./p-75188364.js";function v(t,...o){t||console.error(...o)}function k(t,...o){t||console.warn(...o)}const O=()=>{let t,o=[];return{setPrompt:o=>(k(null==t,"A history supports only one prompt at a time"),t=o,()=>{t===o&&(t=null)}),confirmTransitionTo:(o,e,n,s)=>{if(null!=t){const i="function"==typeof t?t(o,e):t;"string"==typeof i?"function"==typeof n?n(i,s):(k(!1,"A history needs a getUserConfirmation function in order to use a prompt message"),s(!0)):s(!1!==i)}else s(!0)},appendListener:t=>{let e=!0;const n=(...o)=>{e&&t(...o)};return o.push(n),()=>{e=!1,o=o.filter(t=>t!==n)}},notifyListeners:(...t)=>{o.forEach(o=>o(...t))}}},x=(t="scrollPositions")=>{let o=new Map;if(u("sessionStorage")){const e=window.sessionStorage.getItem(t);o=e?new Map(JSON.parse(e)):o}function e(t,e){if(o.set(t,e),u("sessionStorage")){const t=[];o.forEach((o,e)=>{t.push([e,o])}),window.sessionStorage.setItem("scrollPositions",JSON.stringify(t))}}return"scrollRestoration"in history&&(history.scrollRestoration="manual"),{set:e,get:function(t){return o.get(t)},has:function(t){return o.has(t)},capture:function(t){e(t,[window.scrollX,window.scrollY])}}},L=()=>{try{return window.history.state||{}}catch(t){return{}}},S={hashbang:{encodePath:t=>"!"===t.charAt(0)?t:"!/"+h(t),decodePath:t=>"!"===t.charAt(0)?t.substr(1):t},noslash:{encodePath:h,decodePath:s},slash:{encodePath:s,decodePath:s}},H=()=>{const t=window.location.href,o=t.indexOf("#");return-1===o?"":t.substring(o+1)},U=t=>{const o=window.location.href.indexOf("#");window.location.replace(window.location.href.slice(0,o>=0?o:0)+"#"+t)};var j=function(t,o,e,n){return new(e||(e=Promise))(function(s,i){function a(t){try{c(n.next(t))}catch(t){i(t)}}function r(t){try{c(n.throw(t))}catch(t){i(t)}}function c(t){t.done?s(t.value):new e(function(o){o(t.value)}).then(a,r)}c((n=n.apply(t,o||[])).next())})};function E(t,o){const e=0==t.pathname.indexOf(o)?"/"+t.pathname.slice(o.length):t.pathname;return Object.assign({},t,{pathname:e})}const A={browser:(t={})=>{v(f,"Browser history needs a DOM");const o=window.history,e=p(),h=!w(),d=x(),u=null!=t.forceRefresh&&t.forceRefresh,b=null!=t.getUserConfirmation?t.getUserConfirmation:y,T=null!=t.keyLength?t.keyLength:6,S=t.basename?n(s(t.basename)):"",H=t=>{t=t||{};const{key:o,state:e}=t,{pathname:n,search:s,hash:l}=window.location;let h=n+s+l;return k(!S||r(h,S),'You are attempting to use a basename on a page whose URL path does not begin with the basename. Expected path "'+h+'" to begin with "'+S+'".'),S&&(h=c(h,S)),i(h,e,o||a(T))},U=O(),j=t=>{d.capture(J.location.key),Object.assign(J,t),J.location.scrollPosition=d.get(J.location.key),J.length=o.length,U.notifyListeners(J.location,J.action)},E=t=>{P(t)||I(H(t.state))},A=()=>{I(H(L()))};let R=!1;const I=t=>{if(R)R=!1,j();else{const o="POP";U.confirmTransitionTo(t,o,b,e=>{e?j({action:o,location:t}):C(t)})}},C=t=>{let o=M.indexOf(J.location.key);-1===o&&(o=0);let e=M.indexOf(t.key);-1===e&&(e=0);const n=o-e;n&&(R=!0,q(n))},B=H(L());let M=[B.key];const Y=t=>S+l(t),q=t=>{o.go(t)};let V=0;const D=t=>{1===(V+=t)?(g(window,"popstate",E),h&&g(window,"hashchange",A)):0===V&&(m(window,"popstate",E),h&&m(window,"hashchange",A))};let F=!1;const J={length:o.length,action:"POP",location:B,createHref:Y,push:(t,n)=>{k(!("object"==typeof t&&void 0!==t.state&&void 0!==n),"You should avoid providing a 2nd state argument to push when the 1st argument is a location-like object that already has state; it is ignored");const s=i(t,n,a(T),J.location);U.confirmTransitionTo(s,"PUSH",b,t=>{if(!t)return;const n=Y(s),{key:i,state:a}=s;if(e)if(o.pushState({key:i,state:a},void 0,n),u)window.location.href=n;else{const t=M.indexOf(J.location.key),o=M.slice(0,-1===t?0:t+1);o.push(s.key),M=o,j({action:"PUSH",location:s})}else k(void 0===a,"Browser history cannot push state in browsers that do not support HTML5 history"),window.location.href=n})},replace:(t,n)=>{k(!("object"==typeof t&&void 0!==t.state&&void 0!==n),"You should avoid providing a 2nd state argument to replace when the 1st argument is a location-like object that already has state; it is ignored");const s=i(t,n,a(T),J.location);U.confirmTransitionTo(s,"REPLACE",b,t=>{if(!t)return;const n=Y(s),{key:i,state:a}=s;if(e)if(o.replaceState({key:i,state:a},void 0,n),u)window.location.replace(n);else{const t=M.indexOf(J.location.key);-1!==t&&(M[t]=s.key),j({action:"REPLACE",location:s})}else k(void 0===a,"Browser history cannot replace state in browsers that do not support HTML5 history"),window.location.replace(n)})},go:q,goBack:()=>q(-1),goForward:()=>q(1),block:(t="")=>{const o=U.setPrompt(t);return F||(D(1),F=!0),()=>(F&&(F=!1,D(-1)),o())},listen:t=>{const o=U.appendListener(t);return D(1),()=>{D(-1),o()}}};return J},hash:(t={})=>{v(f,"Hash history needs a DOM");const o=window.history,e=b(),h=null!=t.keyLength?t.keyLength:6,{getUserConfirmation:u=y,hashType:p="slash"}=t,w=t.basename?n(s(t.basename)):"",{encodePath:P,decodePath:T}=S[p],x=()=>{let t=T(H());return k(!w||r(t,w),'You are attempting to use a basename on a page whose URL path does not begin with the basename. Expected path "'+t+'" to begin with "'+w+'".'),w&&(t=c(t,w)),i(t,void 0,a(h))},L=O(),j=t=>{Object.assign(N,t),N.length=o.length,L.notifyListeners(N.location,N.action)};let E=!1,A=null;const R=()=>{const t=H(),o=P(t);if(t!==o)U(o);else{const t=x(),o=N.location;if(!E&&d(o,t))return;if(A===l(t))return;A=null,I(t)}},I=t=>{if(E)E=!1,j();else{const o="POP";L.confirmTransitionTo(t,o,u,e=>{e?j({action:o,location:t}):C(t)})}},C=t=>{let o=q.lastIndexOf(l(N.location));-1===o&&(o=0);let e=q.lastIndexOf(l(t));-1===e&&(e=0);const n=o-e;n&&(E=!0,V(n))},B=H(),M=P(B);B!==M&&U(M);const Y=x();let q=[l(Y)];const V=t=>{k(e,"Hash history go(n) causes a full page reload in this browser"),o.go(t)};let D=0;const F=t=>{1===(D+=t)?g(window,"hashchange",R):0===D&&m(window,"hashchange",R)};let J=!1;const N={length:o.length,action:"POP",location:Y,createHref:t=>"#"+P(w+l(t)),push:(t,o)=>{k(void 0===o,"Hash history cannot push state; it is ignored");const e=i(t,void 0,a(h),N.location);L.confirmTransitionTo(e,"PUSH",u,t=>{if(!t)return;const o=l(e),n=P(w+o);if(H()!==n){A=o,(t=>window.location.hash=t)(n);const t=q.lastIndexOf(l(N.location)),s=q.slice(0,-1===t?0:t+1);s.push(o),q=s,j({action:"PUSH",location:e})}else k(!1,"Hash history cannot PUSH the same path; a new entry will not be added to the history stack"),j()})},replace:(t,o)=>{k(void 0===o,"Hash history cannot replace state; it is ignored");const e=i(t,void 0,a(h),N.location);L.confirmTransitionTo(e,"REPLACE",u,t=>{if(!t)return;const o=l(e),n=P(w+o);H()!==n&&(A=o,U(n));const s=q.indexOf(l(N.location));-1!==s&&(q[s]=o),j({action:"REPLACE",location:e})})},go:V,goBack:()=>V(-1),goForward:()=>V(1),block:(t="")=>{const o=L.setPrompt(t);return J||(F(1),J=!0),()=>(J&&(J=!1,F(-1)),o())},listen:t=>{const o=L.appendListener(t);return F(1),()=>{F(-1),o()}}};return N}};class R{constructor(e){t(this,e),this.root="/",this.historyType="browser",this.titleSuffix="",this.routeViewsUpdated=((t={})=>{if(t.scrollToId&&"browser"===this.historyType){const o=document.getElementById(t.scrollToId);if(o)return o.scrollIntoView()}this.scrollTo(t.scrollTopOffset||this.scrollTopOffset)}),this.isServer=o(this,"isServer"),this.queue=o(this,"queue")}componentWillLoad(){this.history=A[this.historyType](),this.history.listen(t=>j(this,void 0,void 0,function*(){t=E(t,this.root),this.location=t})),this.location=E(this.history.location,this.root)}scrollTo(t){if(null!=t&&!this.isServer&&this.history)return"POP"===this.history.action&&Array.isArray(this.history.location.scrollPosition)?this.queue.write(()=>{this.history&&this.history.location&&Array.isArray(this.history.location.scrollPosition)&&window.scrollTo(this.history.location.scrollPosition[0],this.history.location.scrollPosition[1])}):this.queue.write(()=>{window.scrollTo(0,t)})}render(){if(this.location&&this.history)return e(T.Provider,{state:{historyType:this.historyType,location:this.location,titleSuffix:this.titleSuffix,root:this.root,history:this.history,routeViewsUpdated:this.routeViewsUpdated}},e("slot",null))}}export{R as stencil_router};