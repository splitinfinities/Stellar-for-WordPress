const e=window.StellarCore.h;import{a as t,d as r}from"./chunk-7646164d.js";import"./chunk-340b8099.js";import{q as n,r as a}from"./chunk-43ad3764.js";import"./chunk-5ce278cb.js";var i=t(function(e,t){e.exports=function e(t,n,a){function i(s,u){if(!n[s]){if(!t[s]){var l="function"==typeof r&&r;if(!u&&l)return l(s,!0);if(o)return o(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var f=n[s]={exports:{}};t[s][0].call(f.exports,function(e){return i(t[s][1][e]||e)},f,f.exports,e,t,n,a)}return n[s].exports}for(var o="function"==typeof r&&r,s=0;s<a.length;s++)i(a[s]);return i}({1:[function(e,t,r){},{}],2:[function(e,t,r){t.exports=XMLHttpRequest},{}],3:[function(e,t,r){var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=e("./MediaFileReader"),i=function(e){function t(e){!function(e,r){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r._array=e,r._size=e.length,r._isInitialized=!0,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a),n(t,[{key:"init",value:function(e){setTimeout(e.onSuccess,0)}},{key:"loadRange",value:function(e,t){setTimeout(t.onSuccess,0)}},{key:"getByteAt",value:function(e){if(e>=this._array.length)throw new Error("Offset "+e+" hasn't been loaded yet.");return this._array[e]}}],[{key:"canReadFile",value:function(e){return Array.isArray(e)||"function"==typeof Buffer&&Buffer.isBuffer(e)}}]),t}();t.exports=i},{"./MediaFileReader":11}],4:[function(e,t,r){var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=e("./ChunkedFileData"),i=e("./MediaFileReader"),o=function(e){function t(e){!function(e,r){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r._blob=e,r._fileData=new a,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i),n(t,[{key:"_init",value:function(e){this._size=this._blob.size,setTimeout(e.onSuccess,1)}},{key:"loadRange",value:function(e,t){var r=this,n=(this._blob.slice||this._blob.mozSlice||this._blob.webkitSlice).call(this._blob,e[0],e[1]+1),a=new FileReader;a.onloadend=function(n){var i=new Uint8Array(a.result);r._fileData.addData(e[0],i),t.onSuccess()},a.onerror=a.onabort=function(e){t.onError&&t.onError({type:"blob",info:a.error})},a.readAsArrayBuffer(n)}},{key:"getByteAt",value:function(e){return this._fileData.getByteAt(e)}}],[{key:"canReadFile",value:function(e){return"undefined"!=typeof Blob&&e instanceof Blob||"undefined"!=typeof File&&e instanceof File}}]),t}();t.exports=o},{"./ChunkedFileData":5,"./MediaFileReader":11}],5:[function(e,t,r){var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=function(){function e(){!function(t,r){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this),this._fileData=[]}return n(e,null,[{key:"NOT_FOUND",get:function(){return-1}}]),n(e,[{key:"addData",value:function(e,t){var r=e+t.length-1,n=this._getChunkRange(e,r);if(-1===n.startIx)this._fileData.splice(n.insertIx||0,0,{offset:e,data:t});else{var a=this._fileData[n.startIx],i=this._fileData[n.endIx],o=e>a.offset,s=r<i.offset+i.data.length-1,u={offset:Math.min(e,a.offset),data:t};if(o){var l=this._sliceData(a.data,0,e-a.offset);u.data=this._concatData(l,t)}if(s){l=this._sliceData(u.data,0,i.offset-u.offset);u.data=this._concatData(l,i.data)}this._fileData.splice(n.startIx,n.endIx-n.startIx+1,u)}}},{key:"_concatData",value:function(e,t){if("undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView&&ArrayBuffer.isView(e)){var r=new e.constructor(e.length+t.length);return r.set(e,0),r.set(t,e.length),r}return e.concat(t)}},{key:"_sliceData",value:function(e,t,r){return e.slice?e.slice(t,r):e.subarray(t,r)}},{key:"_getChunkRange",value:function(e,t){for(var r=-1,n=-1,a=0,i=0;i<this._fileData.length;a=++i){var o=(s=this._fileData[i].offset)+this._fileData[i].data.length;if(t<s-1)break;if(e<=o+1&&t>=s-1){r=i;break}}if(-1===r)return{startIx:-1,endIx:-1,insertIx:a};for(i=r;i<this._fileData.length;i++){var s;if(t>=(s=this._fileData[i].offset)-1&&(n=i),t<=(o=s+this._fileData[i].data.length)+1)break}return-1===n&&(n=r),{startIx:r,endIx:n}}},{key:"hasDataRange",value:function(e,t){for(var r=0;r<this._fileData.length;r++){var n=this._fileData[r];if(t<n.offset)return!1;if(e>=n.offset&&t<n.offset+n.data.length)return!0}return!1}},{key:"getByteAt",value:function(e){for(var t,r=0;r<this._fileData.length;r++){var n=this._fileData[r].offset;if(e>=n&&e<=n+this._fileData[r].data.length-1){t=this._fileData[r];break}}if(t)return t.data[e-t.offset];throw new Error("Offset "+e+" hasn't been loaded yet.")}}]),e}();t.exports=a},{}],6:[function(e,t,r){var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=e("./MediaTagReader"),i=[4,132],o=[6,134],s=["Other","32x32 pixels 'file icon' (PNG only)","Other file icon","Cover (front)","Cover (back)","Leaflet page","Media (e.g. label side of CD)","Lead artist/lead performer/soloist","Artist/performer","Conductor","Band/Orchestra","Composer","Lyricist/text writer","Recording Location","During recording","During performance","Movie/video screen capture","A bright coloured fish","Illustration","Band/artist logotype","Publisher/Studio logotype"],u=function(e){function t(){return function(e,r){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a),n(t,[{key:"_loadData",value:function(e,t){var r=this;e.loadRange([4,7],{onSuccess:function(){r._loadBlock(e,4,t)}})}},{key:"_loadBlock",value:function(e,t,r){var n=this,a=e.getByteAt(t),s=e.getInteger24At(t+1,!0);if(-1!==i.indexOf(a))e.loadRange([u=t+4,u+s],{onSuccess:function(){n._commentOffset=u,n._nextBlock(e,t,a,s,r)}});else if(-1!==o.indexOf(a)){var u;e.loadRange([u=t+4,u+s],{onSuccess:function(){n._pictureOffset=u,n._nextBlock(e,t,a,s,r)}})}else n._nextBlock(e,t,a,s,r)}},{key:"_nextBlock",value:function(e,t,r,n,a){var i=this;r>127?i._commentOffset?a.onSuccess():a.onError({type:"loadData",info:"Comment block could not be found."}):e.loadRange([t+4+n,t+4+4+n],{onSuccess:function(){i._loadBlock(e,t+4+n,a)}})}},{key:"_parseData",value:function(e,t){for(var r,n,a,i,o,u,l=e.getLongAt(this._commentOffset,!1)+(this._commentOffset+4),c=e.getLongAt(l,!1),f=l+4,d=0;d<c;d++){var g=e.getLongAt(f,!1),h=e.getStringWithCharsetAt(f+4,g,"utf-8").toString(),p=h.indexOf("="),y=[h.slice(0,p),h.slice(p+1)];switch(y[0]){case"TITLE":r=y[1];break;case"ARTIST":n=y[1];break;case"ALBUM":a=y[1];break;case"TRACKNUMBER":i=y[1];break;case"GENRE":o=y[1]}f+=4+g}if(this._pictureOffset){var v=e.getLongAt(this._pictureOffset,!0),m=this._pictureOffset+4,b=e.getLongAt(m,!0),T=m+4,R=e.getStringAt(T,b),S=T+b,_=e.getLongAt(S,!0),A=S+4,k=e.getStringWithCharsetAt(A,_,"utf-8").toString(),C=A+_+16,w=e.getLongAt(C,!0),O=e.getBytesAt(C+4,w,!0);u={format:R,type:s[v],description:k,data:O}}return{type:"FLAC",version:"1",tags:{title:r,artist:n,album:a,track:i,genre:o,picture:u}}}}],[{key:"getTagIdentifierByteRange",value:function(){return{offset:0,length:4}}},{key:"canReadTagFormat",value:function(e){return"fLaC"===String.fromCharCode.apply(String,e.slice(0,4))}}]),t}();t.exports=u},{"./MediaTagReader":12}],7:[function(e,t,r){var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=e("./MediaTagReader"),i=(e("./MediaFileReader"),function(e){function t(){return function(e,r){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a),n(t,[{key:"_loadData",value:function(e,t){var r=e.getSize();e.loadRange([r-128,r-1],t)}},{key:"_parseData",value:function(e,t){var r=e.getSize()-128,n=e.getStringWithCharsetAt(r+3,30).toString(),a=e.getStringWithCharsetAt(r+33,30).toString(),i=e.getStringWithCharsetAt(r+63,30).toString(),s=e.getStringWithCharsetAt(r+93,4).toString(),u=e.getByteAt(r+97+28),l=e.getByteAt(r+97+29);if(0==u&&0!=l)var c="1.1",f=e.getStringWithCharsetAt(r+97,28).toString();else{c="1.0",f=e.getStringWithCharsetAt(r+97,30).toString();l=0}var d=e.getByteAt(r+97+30);if(d<255)var g=o[d];else g="";var h={type:"ID3",version:c,tags:{title:n,artist:a,album:i,year:s,comment:f,genre:g}};return l&&(h.tags.track=l),h}}],[{key:"getTagIdentifierByteRange",value:function(){return{offset:-128,length:128}}},{key:"canReadTagFormat",value:function(e){return"TAG"===String.fromCharCode.apply(String,e.slice(0,3))}}]),t}()),o=["Blues","Classic Rock","Country","Dance","Disco","Funk","Grunge","Hip-Hop","Jazz","Metal","New Age","Oldies","Other","Pop","R&B","Rap","Reggae","Rock","Techno","Industrial","Alternative","Ska","Death Metal","Pranks","Soundtrack","Euro-Techno","Ambient","Trip-Hop","Vocal","Jazz+Funk","Fusion","Trance","Classical","Instrumental","Acid","House","Game","Sound Clip","Gospel","Noise","AlternRock","Bass","Soul","Punk","Space","Meditative","Instrumental Pop","Instrumental Rock","Ethnic","Gothic","Darkwave","Techno-Industrial","Electronic","Pop-Folk","Eurodance","Dream","Southern Rock","Comedy","Cult","Gangsta","Top 40","Christian Rap","Pop/Funk","Jungle","Native American","Cabaret","New Wave","Psychadelic","Rave","Showtunes","Trailer","Lo-Fi","Tribal","Acid Punk","Acid Jazz","Polka","Retro","Musical","Rock & Roll","Hard Rock","Folk","Folk-Rock","National Folk","Swing","Fast Fusion","Bebob","Latin","Revival","Celtic","Bluegrass","Avantgarde","Gothic Rock","Progressive Rock","Psychedelic Rock","Symphonic Rock","Slow Rock","Big Band","Chorus","Easy Listening","Acoustic","Humour","Speech","Chanson","Opera","Chamber Music","Sonata","Symphony","Booty Bass","Primus","Porn Groove","Satire","Slow Jam","Club","Tango","Samba","Folklore","Ballad","Power Ballad","Rhythmic Soul","Freestyle","Duet","Punk Rock","Drum Solo","Acapella","Euro-House","Dance Hall"];t.exports=i},{"./MediaFileReader":11,"./MediaTagReader":12}],8:[function(e,t,r){var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();e("./MediaFileReader");var a=e("./StringUtils"),i=e("./ArrayFileReader"),o={BUF:"Recommended buffer size",CNT:"Play counter",COM:"Comments",CRA:"Audio encryption",CRM:"Encrypted meta frame",ETC:"Event timing codes",EQU:"Equalization",GEO:"General encapsulated object",IPL:"Involved people list",LNK:"Linked information",MCI:"Music CD Identifier",MLL:"MPEG location lookup table",PIC:"Attached picture",POP:"Popularimeter",REV:"Reverb",RVA:"Relative volume adjustment",SLT:"Synchronized lyric/text",STC:"Synced tempo codes",TAL:"Album/Movie/Show title",TBP:"BPM (Beats Per Minute)",TCM:"Composer",TCO:"Content type",TCR:"Copyright message",TDA:"Date",TDY:"Playlist delay",TEN:"Encoded by",TFT:"File type",TIM:"Time",TKE:"Initial key",TLA:"Language(s)",TLE:"Length",TMT:"Media type",TOA:"Original artist(s)/performer(s)",TOF:"Original filename",TOL:"Original Lyricist(s)/text writer(s)",TOR:"Original release year",TOT:"Original album/Movie/Show title",TP1:"Lead artist(s)/Lead performer(s)/Soloist(s)/Performing group",TP2:"Band/Orchestra/Accompaniment",TP3:"Conductor/Performer refinement",TP4:"Interpreted, remixed, or otherwise modified by",TPA:"Part of a set",TPB:"Publisher",TRC:"ISRC (International Standard Recording Code)",TRD:"Recording dates",TRK:"Track number/Position in set",TSI:"Size",TSS:"Software/hardware and settings used for encoding",TT1:"Content group description",TT2:"Title/Songname/Content description",TT3:"Subtitle/Description refinement",TXT:"Lyricist/text writer",TXX:"User defined text information frame",TYE:"Year",UFI:"Unique file identifier",ULT:"Unsychronized lyric/text transcription",WAF:"Official audio file webpage",WAR:"Official artist/performer webpage",WAS:"Official audio source webpage",WCM:"Commercial information",WCP:"Copyright/Legal information",WPB:"Publishers official webpage",WXX:"User defined URL link frame",AENC:"Audio encryption",APIC:"Attached picture",ASPI:"Audio seek point index",CHAP:"Chapter",CTOC:"Table of contents",COMM:"Comments",COMR:"Commercial frame",ENCR:"Encryption method registration",EQU2:"Equalisation (2)",EQUA:"Equalization",ETCO:"Event timing codes",GEOB:"General encapsulated object",GRID:"Group identification registration",IPLS:"Involved people list",LINK:"Linked information",MCDI:"Music CD identifier",MLLT:"MPEG location lookup table",OWNE:"Ownership frame",PRIV:"Private frame",PCNT:"Play counter",POPM:"Popularimeter",POSS:"Position synchronisation frame",RBUF:"Recommended buffer size",RVA2:"Relative volume adjustment (2)",RVAD:"Relative volume adjustment",RVRB:"Reverb",SEEK:"Seek frame",SYLT:"Synchronized lyric/text",SYTC:"Synchronized tempo codes",TALB:"Album/Movie/Show title",TBPM:"BPM (beats per minute)",TCOM:"Composer",TCON:"Content type",TCOP:"Copyright message",TDAT:"Date",TDLY:"Playlist delay",TDRC:"Recording time",TDRL:"Release time",TDTG:"Tagging time",TENC:"Encoded by",TEXT:"Lyricist/Text writer",TFLT:"File type",TIME:"Time",TIPL:"Involved people list",TIT1:"Content group description",TIT2:"Title/songname/content description",TIT3:"Subtitle/Description refinement",TKEY:"Initial key",TLAN:"Language(s)",TLEN:"Length",TMCL:"Musician credits list",TMED:"Media type",TMOO:"Mood",TOAL:"Original album/movie/show title",TOFN:"Original filename",TOLY:"Original lyricist(s)/text writer(s)",TOPE:"Original artist(s)/performer(s)",TORY:"Original release year",TOWN:"File owner/licensee",TPE1:"Lead performer(s)/Soloist(s)",TPE2:"Band/orchestra/accompaniment",TPE3:"Conductor/performer refinement",TPE4:"Interpreted, remixed, or otherwise modified by",TPOS:"Part of a set",TPRO:"Produced notice",TPUB:"Publisher",TRCK:"Track number/Position in set",TRDA:"Recording dates",TRSN:"Internet radio station name",TRSO:"Internet radio station owner",TSOA:"Album sort order",TSOP:"Performer sort order",TSOT:"Title sort order",TSIZ:"Size",TSRC:"ISRC (international standard recording code)",TSSE:"Software/Hardware and settings used for encoding",TSST:"Set subtitle",TYER:"Year",TXXX:"User defined text information frame",UFID:"Unique file identifier",USER:"Terms of use",USLT:"Unsychronized lyric/text transcription",WCOM:"Commercial information",WCOP:"Copyright/Legal information",WOAF:"Official audio file webpage",WOAR:"Official artist/performer webpage",WOAS:"Official audio source webpage",WORS:"Official internet radio station homepage",WPAY:"Payment",WPUB:"Publishers official webpage",WXXX:"User defined URL link frame"},s=function(){function e(){!function(t,r){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this)}return n(e,null,[{key:"getFrameReaderFunction",value:function(e){return e in u?u[e]:"T"===e[0]?u["T*"]:"W"===e[0]?u["W*"]:null}},{key:"readFrames",value:function(t,r,n,a,i){for(var o={},s=this._getFrameHeaderSize(a);t<r-s;){var u=this._readFrameHeader(n,t,a),l=u.id;if(!l)break;var c=u.flags,f=u.size,d=t+u.headerSize,g=n;if(t+=u.headerSize+u.size,!i||-1!==i.indexOf(l)){if("MP3e"===l||"\0MP3"===l||"\0\0MP"===l||" MP3"===l)break;c&&c.format.unsynchronisation&&(g=this.getUnsyncFileReader(g,d,f),d=0,f=g.getSize()),c&&c.format.data_length_indicator&&(d+=4,f-=4);var h=e.getFrameReaderFunction(l),p=h?h.apply(this,[d,f,g,c,a]):null,y={id:l,size:f,description:this._getFrameDescription(l),data:p};l in o?(o[l].id&&(o[l]=[o[l]]),o[l].push(y)):o[l]=y}}return o}},{key:"_getFrameHeaderSize",value:function(e){var t=e.major;return 2==t?6:3==t||4==t?10:0}},{key:"_readFrameHeader",value:function(e,t,r){var n=r.major,a=null,i=this._getFrameHeaderSize(r);switch(n){case 2:var o=e.getStringAt(t,3),s=e.getInteger24At(t+3,!0);break;case 3:o=e.getStringAt(t,4),s=e.getLongAt(t+4,!0);break;case 4:o=e.getStringAt(t,4),s=e.getSynchsafeInteger32At(t+4)}return o!=String.fromCharCode(0,0,0)&&o!=String.fromCharCode(0,0,0,0)||(o=""),o&&n>2&&(a=this._readFrameFlags(e,t+8)),{id:o||"",size:s||0,headerSize:i||0,flags:a}}},{key:"_readFrameFlags",value:function(e,t){return{message:{tag_alter_preservation:e.isBitSetAt(t,6),file_alter_preservation:e.isBitSetAt(t,5),read_only:e.isBitSetAt(t,4)},format:{grouping_identity:e.isBitSetAt(t+1,7),compression:e.isBitSetAt(t+1,3),encryption:e.isBitSetAt(t+1,2),unsynchronisation:e.isBitSetAt(t+1,1),data_length_indicator:e.isBitSetAt(t+1,0)}}}},{key:"_getFrameDescription",value:function(e){return e in o?o[e]:"Unknown"}},{key:"getUnsyncFileReader",value:function(e,t,r){for(var n=e.getBytesAt(t,r),a=0;a<n.length-1;a++)255===n[a]&&0===n[a+1]&&n.splice(a+1,1);return new i(n)}}]),e}(),u={};function l(e){var t;switch(e){case 0:t="iso-8859-1";break;case 1:t="utf-16";break;case 2:t="utf-16be";break;case 3:t="utf-8";break;default:t="iso-8859-1"}return t}function c(e,t,r,n){var a=r.getStringWithCharsetAt(e+1,t-1,n),i=r.getStringWithCharsetAt(e+1+a.bytesReadCount,t-1-a.bytesReadCount);return{user_description:a.toString(),data:i.toString()}}u.APIC=function(e,t,r,n,a){var i=e,o=l(r.getByteAt(e));switch(a&&a.major){case 2:var s=r.getStringAt(e+1,3);e+=4;break;case 3:case 4:e+=1+(s=r.getStringWithCharsetAt(e+1,t-1)).bytesReadCount;break;default:throw new Error("Couldn't read ID3v2 major version.")}var u=r.getByteAt(e),c=f[u],d=r.getStringWithCharsetAt(e+1,t-(e-i)-1,o);return e+=1+d.bytesReadCount,{format:s.toString(),type:c,description:d.toString(),data:r.getBytesAt(e,i+t-e)}},u.CHAP=function(e,t,r,n,i){var o=e,s={},u=a.readNullTerminatedString(r.getBytesAt(e,t));s.id=u.toString(),s.startTime=r.getLongAt(e+=u.bytesReadCount,!0),s.endTime=r.getLongAt(e+=4,!0),s.startOffset=r.getLongAt(e+=4,!0),s.endOffset=r.getLongAt(e+=4,!0);var l=t-((e+=4)-o);return s.subFrames=this.readFrames(e,e+l,r,i),s},u.CTOC=function(e,t,r,n,i){var o=e,s={childElementIds:[],id:void 0,topLevel:void 0,ordered:void 0,entryCount:void 0,subFrames:void 0},u=a.readNullTerminatedString(r.getBytesAt(e,t));s.id=u.toString(),s.topLevel=r.isBitSetAt(e+=u.bytesReadCount,1),s.ordered=r.isBitSetAt(e,0),s.entryCount=r.getByteAt(++e),e++;for(var l=0;l<s.entryCount;l++){var c=a.readNullTerminatedString(r.getBytesAt(e,t-(e-o)));s.childElementIds.push(c.toString()),e+=c.bytesReadCount}return s.subFrames=this.readFrames(e,e+(t-(e-o)),r,i),s},u.COMM=function(e,t,r,n,a){var i=e,o=l(r.getByteAt(e)),s=r.getStringAt(e+1,3),u=r.getStringWithCharsetAt(e+4,t-4,o),c=r.getStringWithCharsetAt(e+=4+u.bytesReadCount,i+t-e,o);return{language:s,short_description:u.toString(),text:c.toString()}},u.COM=u.COMM,u.PIC=function(e,t,r,n,a){return u.APIC(e,t,r,n,a)},u.PCNT=function(e,t,r,n,a){return r.getLongAt(e,!1)},u.CNT=u.PCNT,u["T*"]=function(e,t,r,n,a){var i=l(r.getByteAt(e));return r.getStringWithCharsetAt(e+1,t-1,i).toString()},u.TXXX=function(e,t,r,n,a){var i=l(r.getByteAt(e));return c(e,t,r,i)},u.WXXX=function(e,t,r,n,a){if(0===t)return null;var i=l(r.getByteAt(e));return c(e,t,r,i)},u["W*"]=function(e,t,r,n,a){return 0===t?null:r.getStringWithCharsetAt(e,t,"iso-8859-1").toString()},u.TCON=function(e,t,r,n){return u["T*"].apply(this,arguments).replace(/^\(\d+\)/,"")},u.TCO=u.TCON,u.USLT=function(e,t,r,n,a){var i=e,o=l(r.getByteAt(e)),s=r.getStringAt(e+1,3),u=r.getStringWithCharsetAt(e+4,t-4,o),c=r.getStringWithCharsetAt(e+=4+u.bytesReadCount,i+t-e,o);return{language:s,descriptor:u.toString(),lyrics:c.toString()}},u.ULT=u.USLT,u.UFID=function(e,t,r,n,i){var o=a.readNullTerminatedString(r.getBytesAt(e,t)),s=r.getBytesAt(e+=o.bytesReadCount,t-o.bytesReadCount);return{ownerIdentifier:o.toString(),identifier:s}};var f=["Other","32x32 pixels 'file icon' (PNG only)","Other file icon","Cover (front)","Cover (back)","Leaflet page","Media (e.g. label side of CD)","Lead artist/lead performer/soloist","Artist/performer","Conductor","Band/Orchestra","Composer","Lyricist/text writer","Recording Location","During recording","During performance","Movie/video screen capture","A bright coloured fish","Illustration","Band/artist logotype","Publisher/Studio logotype"];t.exports=s},{"./ArrayFileReader":3,"./MediaFileReader":11,"./StringUtils":13}],9:[function(e,t,r){var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=e("./MediaTagReader"),i=(e("./MediaFileReader"),e("./ID3v2FrameReader")),o=function(e){function t(){return function(e,r){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a),n(t,[{key:"_loadData",value:function(e,t){e.loadRange([6,9],{onSuccess:function(){e.loadRange([0,10+e.getSynchsafeInteger32At(6)-1],t)},onError:t.onError})}},{key:"_parseData",value:function(e,t){var r=0,n=e.getByteAt(r+3);if(n>4)return{type:"ID3",version:">2.4",tags:{}};var a=e.getByteAt(r+4),o=e.isBitSetAt(r+5,7),u=e.isBitSetAt(r+5,6),l=e.isBitSetAt(r+5,5),c=e.getSynchsafeInteger32At(r+6);(r+=10,u)&&(r+=e.getLongAt(r,!0)+4);var f={type:"ID3",version:"2."+n+"."+a,major:n,revision:a,flags:{unsynchronisation:o,extended_header:u,experimental_indicator:l,footer_present:!1},size:c,tags:{}};if(t)var d=this._expandShortcutTags(t);var g=c+10;f.flags.unsynchronisation&&(e=i.getUnsyncFileReader(e,r,c),r=0,g=e.getSize());var h=i.readFrames(r,g,e,f,d);for(var p in s)if(s.hasOwnProperty(p)){var y=this._getFrameData(h,s[p]);y&&(f.tags[p]=y)}for(var v in h)h.hasOwnProperty(v)&&(f.tags[v]=h[v]);return f}},{key:"_getFrameData",value:function(e,t){for(var r,n=0;r=t[n];n++)if(r in e)return(e[r]instanceof Array?e[r][0]:e[r]).data}},{key:"getShortcuts",value:function(){return s}}],[{key:"getTagIdentifierByteRange",value:function(){return{offset:0,length:10}}},{key:"canReadTagFormat",value:function(e){return"ID3"===String.fromCharCode.apply(String,e.slice(0,3))}}]),t}(),s={title:["TIT2","TT2"],artist:["TPE1","TP1"],album:["TALB","TAL"],year:["TYER","TYE"],comment:["COMM","COM"],track:["TRCK","TRK"],genre:["TCON","TCO"],picture:["APIC","PIC"],lyrics:["USLT","ULT"]};t.exports=o},{"./ID3v2FrameReader":8,"./MediaFileReader":11,"./MediaTagReader":12}],10:[function(e,t,r){var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=e("./MediaTagReader"),i=(e("./MediaFileReader"),function(e){function t(){return function(e,r){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a),n(t,[{key:"_loadData",value:function(e,t){var r=this;e.loadRange([0,16],{onSuccess:function(){r._loadAtom(e,0,"",t)},onError:t.onError})}},{key:"_loadAtom",value:function(e,t,r,n){if(t>=e.getSize())n.onSuccess();else{var a=this,i=e.getLongAt(t,!0);if(0==i||isNaN(i))n.onSuccess();else{var o=e.getStringAt(t+4,4);if(this._isContainerAtom(o)){"meta"==o&&(t+=4);var s=(r?r+".":"")+o;"moov.udta.meta.ilst"===s?e.loadRange([t,t+i],n):e.loadRange([t+8,t+8+8],{onSuccess:function(){a._loadAtom(e,t+8,s,n)},onError:n.onError})}else e.loadRange([t+i,t+i+8],{onSuccess:function(){a._loadAtom(e,t+i,r,n)},onError:n.onError})}}}},{key:"_isContainerAtom",value:function(e){return["moov","udta","meta","ilst"].indexOf(e)>=0}},{key:"_canReadAtom",value:function(e){return"----"!==e}},{key:"_parseData",value:function(e,t){var r={};for(var n in t=this._expandShortcutTags(t),this._readAtom(r,e,0,e.getSize(),t),u)if(u.hasOwnProperty(n)){var a=r[u[n]];a&&(r[n]="track"===n?a.data.track:a.data)}return{type:"MP4",ftyp:e.getStringAt(8,4),version:e.getLongAt(12,!0),tags:r}}},{key:"_readAtom",value:function(e,t,r,n,a,i,o){o=void 0===o?"":o+"  ";for(var s=r;s<r+n;){var u=t.getLongAt(s,!0);if(0==u)return;var l=t.getStringAt(s+4,4);if(this._isContainerAtom(l))return"meta"==l&&(s+=4),void this._readAtom(e,t,s+8,u-8,a,(i?i+".":"")+l,o);(!a||a.indexOf(l)>=0)&&"moov.udta.meta.ilst"===i&&this._canReadAtom(l)&&(e[l]=this._readMetadataAtom(t,s)),s+=u}}},{key:"_readMetadataAtom",value:function(e,t){var r=e.getLongAt(t,!0),n=e.getStringAt(t+4,4),a=e.getInteger24At(t+16+1,!0),i=o[a];if("trkn"==n)u={track:e.getByteAt(t+16+11),total:e.getByteAt(t+16+13)};else if("disk"==n)u={disk:e.getByteAt(t+16+11),total:e.getByteAt(t+16+13)};else{var u,l=t+24,c=r-24;switch("covr"===n&&"uint8"===i&&(i="jpeg"),i){case"text":u=e.getStringWithCharsetAt(l,c,"utf-8").toString();break;case"uint8":u=e.getShortAt(l,!1);break;case"int":case"uint":u=("int"==i?1==c?e.getSByteAt:2==c?e.getSShortAt:4==c?e.getSLongAt:e.getLongAt:1==c?e.getByteAt:2==c?e.getShortAt:e.getLongAt).call(e,l+(8==c?4:0),!0);break;case"jpeg":case"png":u={format:"image/"+i,data:e.getBytesAt(l,c)}}}return{id:n,size:r,description:s[n]||"Unknown",data:u}}},{key:"getShortcuts",value:function(){return u}}],[{key:"getTagIdentifierByteRange",value:function(){return{offset:0,length:16}}},{key:"canReadTagFormat",value:function(e){return"ftyp"===String.fromCharCode.apply(String,e.slice(4,8))}}]),t}()),o={0:"uint8",1:"text",13:"jpeg",14:"png",21:"int",22:"uint"},s={"©alb":"Album","©ART":"Artist",aART:"Album Artist","©day":"Release Date","©nam":"Title","©gen":"Genre",gnre:"Genre",trkn:"Track Number","©wrt":"Composer","©too":"Encoding Tool","©enc":"Encoded By",cprt:"Copyright",covr:"Cover Art","©grp":"Grouping",keyw:"Keywords","©lyr":"Lyrics","©cmt":"Comment",tmpo:"Tempo",cpil:"Compilation",disk:"Disc Number",tvsh:"TV Show Name",tven:"TV Episode ID",tvsn:"TV Season",tves:"TV Episode",tvnn:"TV Network",desc:"Description",ldes:"Long Description",sonm:"Sort Name",soar:"Sort Artist",soaa:"Sort Album",soco:"Sort Composer",sosn:"Sort Show",purd:"Purchase Date",pcst:"Podcast",purl:"Podcast URL",catg:"Category",hdvd:"HD Video",stik:"Media Type",rtng:"Content Rating",pgap:"Gapless Playback",apID:"Purchase Account",sfID:"Country Code",atID:"Artist ID",cnID:"Catalog ID",plID:"Collection ID",geID:"Genre ID","xid ":"Vendor Information",flvr:"Codec Flavor"},u={title:"©nam",artist:"©ART",album:"©alb",year:"©day",comment:"©cmt",track:"trkn",genre:"©gen",picture:"covr",lyrics:"©lyr"};t.exports=i},{"./MediaFileReader":11,"./MediaTagReader":12}],11:[function(e,t,r){var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=e("./StringUtils"),i=function(){function e(t){!function(t,r){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this),this._isInitialized=!1,this._size=0}return n(e,[{key:"init",value:function(e){var t=this;if(!this._isInitialized)return this._init({onSuccess:function(){t._isInitialized=!0,e.onSuccess()},onError:e.onError});setTimeout(e.onSuccess,1)}},{key:"_init",value:function(e){throw new Error("Must implement init function")}},{key:"loadRange",value:function(e,t){throw new Error("Must implement loadRange function")}},{key:"getSize",value:function(){if(!this._isInitialized)throw new Error("init() must be called first.");return this._size}},{key:"getByteAt",value:function(e){throw new Error("Must implement getByteAt function")}},{key:"getBytesAt",value:function(e,t){for(var r=new Array(t),n=0;n<t;n++)r[n]=this.getByteAt(e+n);return r}},{key:"isBitSetAt",value:function(e,t){return 0!=(this.getByteAt(e)&1<<t)}},{key:"getSByteAt",value:function(e){var t=this.getByteAt(e);return t>127?t-256:t}},{key:"getShortAt",value:function(e,t){var r=t?(this.getByteAt(e)<<8)+this.getByteAt(e+1):(this.getByteAt(e+1)<<8)+this.getByteAt(e);return r<0&&(r+=65536),r}},{key:"getSShortAt",value:function(e,t){var r=this.getShortAt(e,t);return r>32767?r-65536:r}},{key:"getLongAt",value:function(e,t){var r=this.getByteAt(e),n=this.getByteAt(e+1),a=this.getByteAt(e+2),i=this.getByteAt(e+3),o=t?(((r<<8)+n<<8)+a<<8)+i:(((i<<8)+a<<8)+n<<8)+r;return o<0&&(o+=4294967296),o}},{key:"getSLongAt",value:function(e,t){var r=this.getLongAt(e,t);return r>2147483647?r-4294967296:r}},{key:"getInteger24At",value:function(e,t){var r=this.getByteAt(e),n=this.getByteAt(e+1),a=this.getByteAt(e+2),i=t?((r<<8)+n<<8)+a:((a<<8)+n<<8)+r;return i<0&&(i+=16777216),i}},{key:"getStringAt",value:function(e,t){for(var r=[],n=e,a=0;n<e+t;n++,a++)r[a]=String.fromCharCode(this.getByteAt(n));return r.join("")}},{key:"getStringWithCharsetAt",value:function(e,t,r){var n,i=this.getBytesAt(e,t);switch((r||"").toLowerCase()){case"utf-16":case"utf-16le":case"utf-16be":n=a.readUTF16String(i,"utf-16be"===r);break;case"utf-8":n=a.readUTF8String(i);break;default:n=a.readNullTerminatedString(i)}return n}},{key:"getCharAt",value:function(e){return String.fromCharCode(this.getByteAt(e))}},{key:"getSynchsafeInteger32At",value:function(e){var t=this.getByteAt(e),r=this.getByteAt(e+1),n=this.getByteAt(e+2);return 127&this.getByteAt(e+3)|(127&n)<<7|(127&r)<<14|(127&t)<<21}}],[{key:"canReadFile",value:function(e){throw new Error("Must implement canReadFile function")}}]),e}();t.exports=i},{"./StringUtils":13}],12:[function(e,t,r){var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();e("./MediaFileReader");var a=function(){function e(t){!function(t,r){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this),this._mediaFileReader=t,this._tags=null}return n(e,[{key:"setTagsToRead",value:function(e){return this._tags=e,this}},{key:"read",value:function(e){var t=this;this._mediaFileReader.init({onSuccess:function(){t._loadData(t._mediaFileReader,{onSuccess:function(){try{var r=t._parseData(t._mediaFileReader,t._tags)}catch(t){if(e.onError)return void e.onError({type:"parseData",info:t.message})}e.onSuccess(r)},onError:e.onError})},onError:e.onError})}},{key:"getShortcuts",value:function(){return{}}},{key:"_loadData",value:function(e,t){throw new Error("Must implement _loadData function")}},{key:"_parseData",value:function(e,t){throw new Error("Must implement _parseData function")}},{key:"_expandShortcutTags",value:function(e){if(!e)return null;for(var t,r=[],n=this.getShortcuts(),a=0;t=e[a];a++)r=r.concat(n[t]||[t]);return r}}],[{key:"getTagIdentifierByteRange",value:function(){throw new Error("Must implement")}},{key:"canReadTagFormat",value:function(e){throw new Error("Must implement")}}]),e}();t.exports=a},{"./MediaFileReader":11}],13:[function(e,t,r){var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=function(){function e(t,r){!function(t,r){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this),this._value=t,this.bytesReadCount=r,this.length=t.length}return n(e,[{key:"toString",value:function(){return this._value}}]),e}();t.exports={readUTF16String:function(e,t,r){var n=0,i=1,o=0;r=Math.min(r||e.length,e.length),254==e[0]&&255==e[1]?(t=!0,n=2):255==e[0]&&254==e[1]&&(t=!1,n=2),t&&(i=0,o=1);for(var s=[],u=0;n<r;u++){var l=e[n+i],c=(l<<8)+e[n+o];if(n+=2,0==c)break;if(l<216||l>=224)s[u]=String.fromCharCode(c);else{var f=e[n+i],d=e[n+o];n+=2,s[u]=String.fromCharCode(c,(f<<8)+d)}}return new a(s.join(""),n)},readUTF8String:function(e,t){var r=0;t=Math.min(t||e.length,e.length),239==e[0]&&187==e[1]&&191==e[2]&&(r=3);for(var n=[],i=0;r<t;i++){var o=e[r++];if(0==o)break;if(o<128)n[i]=String.fromCharCode(o);else if(o>=194&&o<224){var s=e[r++];n[i]=String.fromCharCode(((31&o)<<6)+(63&s))}else if(o>=224&&o<240){s=e[r++];var u=e[r++];n[i]=String.fromCharCode(((255&o)<<12)+((63&s)<<6)+(63&u))}else if(o>=240&&o<245){var l=((7&o)<<18)+((63&(s=e[r++]))<<12)+((63&(u=e[r++]))<<6)+(63&e[r++])-65536;n[i]=String.fromCharCode(55296+(l>>10),56320+(1023&l))}}return new a(n.join(""),r)},readNullTerminatedString:function(e,t){var r=[];t=t||e.length;for(var n=0;n<t;){var i=e[n++];if(0==i)break;r[n-1]=String.fromCharCode(i)}return new a(r.join(""),n)}}},{}],14:[function(e,t,r){var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=e("./ChunkedFileData"),i=e("./MediaFileReader"),o=function(t){function r(e){!function(e,t){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}(this);var t=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(r.__proto__||Object.getPrototypeOf(r)).call(this));return t._url=e,t._fileData=new a,t}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(r,i),n(r,[{key:"_init",value:function(e){r._config.avoidHeadRequests?this._fetchSizeWithGetRequest(e):this._fetchSizeWithHeadRequest(e)}},{key:"_fetchSizeWithHeadRequest",value:function(e){var t=this;this._makeXHRRequest("HEAD",null,{onSuccess:function(r){var n=t._parseContentLength(r);n?(t._size=n,e.onSuccess()):t._fetchSizeWithGetRequest(e)},onError:e.onError})}},{key:"_fetchSizeWithGetRequest",value:function(e){var t=this,r=this._roundRangeToChunkMultiple([0,0]);this._makeXHRRequest("GET",r,{onSuccess:function(r){var n=t._parseContentRange(r),a=t._getXhrResponseContent(r);if(n){if(null==n.instanceLength)return void t._fetchEntireFile(e);t._size=n.instanceLength}else t._size=a.length;t._fileData.addData(0,a),e.onSuccess()},onError:e.onError})}},{key:"_fetchEntireFile",value:function(e){var t=this;this._makeXHRRequest("GET",null,{onSuccess:function(r){var n=t._getXhrResponseContent(r);t._size=n.length,t._fileData.addData(0,n),e.onSuccess()},onError:e.onError})}},{key:"_getXhrResponseContent",value:function(e){return e.responseBody||e.responseText||""}},{key:"_parseContentLength",value:function(e){var t=this._getResponseHeader(e,"Content-Length");return null==t?t:parseInt(t,10)}},{key:"_parseContentRange",value:function(e){var t=this._getResponseHeader(e,"Content-Range");if(t){var r=t.match(/bytes (\d+)-(\d+)\/(?:(\d+)|\*)/i);if(!r)throw new Error("FIXME: Unknown Content-Range syntax: "+t);return{firstBytePosition:parseInt(r[1],10),lastBytePosition:parseInt(r[2],10),instanceLength:r[3]?parseInt(r[3],10):null}}return null}},{key:"loadRange",value:function(e,t){var r=this;r._fileData.hasDataRange(e[0],Math.min(r._size,e[1]))?setTimeout(t.onSuccess,1):((e=this._roundRangeToChunkMultiple(e))[1]=Math.min(r._size,e[1]),this._makeXHRRequest("GET",e,{onSuccess:function(n){var a=r._getXhrResponseContent(n);r._fileData.addData(e[0],a),t.onSuccess()},onError:t.onError}))}},{key:"_roundRangeToChunkMultiple",value:function(e){var t=1024*Math.ceil((e[1]-e[0]+1)/1024);return[e[0],e[0]+t-1]}},{key:"_makeXHRRequest",value:function(e,t,n){var a=this._createXHRObject();a.open(e,this._url);var i=function(){200===a.status||206===a.status?n.onSuccess(a):n.onError&&n.onError({type:"xhr",info:"Unexpected HTTP status "+a.status+".",xhr:a}),a=null};void 0!==a.onload?(a.onload=i,a.onerror=function(){n.onError&&n.onError({type:"xhr",info:"Generic XHR error, check xhr object.",xhr:a})}):a.onreadystatechange=function(){4===a.readyState&&i()},r._config.timeoutInSec&&(a.timeout=1e3*r._config.timeoutInSec,a.ontimeout=function(){n.onError&&n.onError({type:"xhr",info:"Timeout after "+a.timeout/1e3+"s. Use jsmediatags.Config.setXhrTimeout to override.",xhr:a})}),a.overrideMimeType("text/plain; charset=x-user-defined"),t&&this._setRequestHeader(a,"Range","bytes="+t[0]+"-"+t[1]),this._setRequestHeader(a,"If-Modified-Since","Sat, 01 Jan 1970 00:00:00 GMT"),a.send(null)}},{key:"_setRequestHeader",value:function(e,t,n){r._config.disallowedXhrHeaders.indexOf(t.toLowerCase())<0&&e.setRequestHeader(t,n)}},{key:"_hasResponseHeader",value:function(e,t){var r=e.getAllResponseHeaders();if(!r)return!1;for(var n=r.split("\r\n"),a=[],i=0;i<n.length;i++)a[i]=n[i].split(":")[0].toLowerCase();return a.indexOf(t.toLowerCase())>=0}},{key:"_getResponseHeader",value:function(e,t){return this._hasResponseHeader(e,t)?e.getResponseHeader(t):null}},{key:"getByteAt",value:function(e){return 255&this._fileData.getByteAt(e).charCodeAt(0)}},{key:"_isWebWorker",value:function(){return"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope}},{key:"_createXHRObject",value:function(){if("undefined"==typeof window&&!this._isWebWorker())return new(e("xhr2").XMLHttpRequest);if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;throw new Error("XMLHttpRequest is not supported")}}],[{key:"canReadFile",value:function(e){return"string"==typeof e&&/^[a-z]+:\/\//i.test(e)}},{key:"setConfig",value:function(e){for(var t in e)e.hasOwnProperty(t)&&(this._config[t]=e[t]);for(var r=this._config.disallowedXhrHeaders,n=0;n<r.length;n++)r[n]=r[n].toLowerCase()}}]),r}();o._config={avoidHeadRequests:!1,disallowedXhrHeaders:[],timeoutInSec:30},t.exports=o},{"./ChunkedFileData":5,"./MediaFileReader":11,xhr2:2}],15:[function(e,t,r){var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}e("./MediaFileReader");var i=e("./NodeFileReader"),o=e("./XhrFileReader"),s=e("./BlobFileReader"),u=e("./ArrayFileReader"),l=(e("./MediaTagReader"),e("./ID3v1TagReader")),c=e("./ID3v2TagReader"),f=e("./MP4TagReader"),d=e("./FLACTagReader"),g=[],h=[];function p(e,t){return!(e.offset>=0&&e.offset+e.length>=t||e.offset<0&&(-e.offset>t||e.offset+e.length>0))}var y=function(){function e(t){a(this,e),this._file=t}return n(e,[{key:"setTagsToRead",value:function(e){return this._tagsToRead=e,this}},{key:"setFileReader",value:function(e){return this._fileReader=e,this}},{key:"setTagReader",value:function(e){return this._tagReader=e,this}},{key:"read",value:function(e){var t=new(this._getFileReader())(this._file),r=this;t.init({onSuccess:function(){r._getTagReader(t,{onSuccess:function(n){new n(t).setTagsToRead(r._tagsToRead).read(e)},onError:e.onError})},onError:e.onError})}},{key:"_getFileReader",value:function(){return this._fileReader?this._fileReader:this._findFileReader()}},{key:"_findFileReader",value:function(){for(var e=0;e<g.length;e++)if(g[e].canReadFile(this._file))return g[e];throw new Error("No suitable file reader found for "+this._file)}},{key:"_getTagReader",value:function(e,t){if(this._tagReader){var r=this._tagReader;setTimeout(function(){t.onSuccess(r)},1)}else this._findTagReader(e,t)}},{key:"_findTagReader",value:function(e,t){for(var r=[],n=[],a=e.getSize(),i=0;i<h.length;i++){var o=h[i].getTagIdentifierByteRange();p(o,a)&&(o.offset>=0&&o.offset<a/2||o.offset<0&&o.offset<-a/2?r.push(h[i]):n.push(h[i]))}var s=!1,u={onSuccess:function(){if(s){for(var r=0;r<h.length;r++){var n=h[r].getTagIdentifierByteRange();if(p(n,a)){try{var i=e.getBytesAt(n.offset>=0?n.offset:n.offset+a,n.length)}catch(e){return void(t.onError&&t.onError({type:"fileReader",info:e.message}))}if(h[r].canReadTagFormat(i))return void t.onSuccess(h[r])}}t.onError&&t.onError({type:"tagFormat",info:"No suitable tag reader found"})}else s=!0},onError:t.onError};this._loadTagIdentifierRanges(e,r,u),this._loadTagIdentifierRanges(e,n,u)}},{key:"_loadTagIdentifierRanges",value:function(e,t,r){if(0!==t.length){for(var n=[Number.MAX_VALUE,0],a=e.getSize(),i=0;i<t.length;i++){var o=t[i].getTagIdentifierByteRange(),s=o.offset>=0?o.offset:o.offset+a,u=s+o.length-1;n[0]=Math.min(s,n[0]),n[1]=Math.max(u,n[1])}e.loadRange(n,r)}else setTimeout(r.onSuccess,1)}}]),e}(),v=function(){function e(){a(this,e)}return n(e,null,[{key:"addFileReader",value:function(t){return g.push(t),e}},{key:"addTagReader",value:function(t){return h.push(t),e}},{key:"removeTagReader",value:function(t){var r=h.indexOf(t);return r>=0&&h.splice(r,1),e}},{key:"EXPERIMENTAL_avoidHeadRequests",value:function(){o.setConfig({avoidHeadRequests:!0})}},{key:"setDisallowedXhrHeaders",value:function(e){o.setConfig({disallowedXhrHeaders:e})}},{key:"setXhrTimeoutInSec",value:function(e){o.setConfig({timeoutInSec:e})}}]),e}();v.addFileReader(o).addFileReader(s).addFileReader(u).addTagReader(c).addTagReader(l).addTagReader(f).addTagReader(d),"undefined"==typeof process||process.browser||v.addFileReader(i),t.exports={read:function(e,t){new y(e).read(t)},Reader:y,Config:v}},{"./ArrayFileReader":3,"./BlobFileReader":4,"./FLACTagReader":6,"./ID3v1TagReader":7,"./ID3v2TagReader":9,"./MP4TagReader":10,"./MediaFileReader":11,"./MediaTagReader":12,"./NodeFileReader":1,"./XhrFileReader":14}]},{},[15])(15)}),o=()=>{const e={};return e.promise=new Promise((t,r)=>{e.resolve=t,e.reject=r}),e};const s=1;function u(e){const t=o();return e.onerror=(r=>{"function"==typeof r.preventDefault&&r.preventDefault(),t.reject(e.error)}),e.onsuccess=(()=>t.resolve(e.result)),t.promise}class l{constructor(){this._index=0}get url(){return this.src.startsWith(".")?window.location.origin+n(this.src):window.location.origin+this.src}async componentWillLoad(){this.player=this.element.closest("stellar-playlist"),this.player.load&&this.load(),this.player.addEventListener("load_songs",()=>{this.load()})}componentDidLoad(){}songChangedHandler(){this.songChanged.emit(this._index)}updateDetails(e){this.title=e.title,this.album=e.album,this.genre=e.genre,this.artist=e.artist,this.picture=e.picture}async load(){const e=await function(e){const t=e;return new Promise((r,n)=>{const a=window.indexedDB.open(e,s);a.onupgradeneeded=(()=>a.result.createObjectStore(t)),a.onblocked=(()=>n(new Error("onblocked"))),a.onerror=(()=>n(a.error)),a.onsuccess=(()=>{const e=a.result;r((r,n)=>(function({db:e,storeName:t,transactionType:r,fn:n}){return new Promise((a,i)=>{const o=e.transaction(t,r),s=o.objectStore(t),l=n(s),c=Array.isArray(l)?Promise.all(l.map(u)):u(l);o.onerror=(()=>i(o.error)),o.oncomplete=(()=>a(c))})})({db:e,storeName:t,transactionType:r,fn:n}))})})}("songs"),t=await e("readonly",e=>e.get(this.src));if(t){var r=JSON.parse(t);const n=await e("readonly",e=>e.get(r.album+"_picture"));r.picture=n,this.updateDetails(r)}else i.read(this.url,{onSuccess:async t=>{var r={title:t.tags.title,album:t.tags.album,genre:t.tags.genre,artist:t.tags.artist,picture:t.tags.picture};if(t.tags.picture){for(var n="",a=0;a<t.tags.picture.data.length;a++)n+=String.fromCharCode(t.tags.picture.data[a]);var i="data:image/jpeg;base64,"+window.btoa(n);r.picture=i,await e("readwrite",e=>e.put(i,r.album+"_picture"))}else r.picture=void 0;await e("readwrite",e=>e.put(JSON.stringify(r),this.src)),this.updateDetails(r)},onError:e=>{this.error=e}});this.loaded.emit({el:this.element})}async details(){return{title:this.title,album:this.album,genre:this.genre,artist:this.artist,picture:this.picture}}async preload(){var e=new Audio;e.src=this.src,e.preload="auto",e.volume=1}async play(){this.playing||(this.songChangedHandler(),this.playing=!0,this.player.prepare(this.element),this.player.play())}async switching(){this.playing=!1}async getIndex(){return this._index}async setIndex(e){this._index=e}render(){return e("button",{onClick:()=>this.play()},e("span",{class:"index"},!this.playing&&a(this._index),this.playing&&e("stellar-asset",{name:"play"})),e("div",{class:"tracklisting"},this.artwork&&e("img",{src:this.picture,class:"preview-image"}),e("h2",null,e("span",null,this.title||"Loading...")," / ",this.artist||"Loading...")),e("img",{src:this.picture,class:"backdrop"}))}static get is(){return"stellar-song"}static get encapsulation(){return"shadow"}static get properties(){return{_index:{state:!0},album:{state:!0},artist:{state:!0},artwork:{type:Boolean,attr:"artwork"},details:{method:!0},element:{elementRef:!0},error:{state:!0},genre:{state:!0},getIndex:{method:!0},load:{method:!0},picture:{state:!0},play:{method:!0},player:{state:!0},playing:{type:Boolean,attr:"playing",reflectToAttr:!0,mutable:!0},preload:{method:!0},setIndex:{method:!0},src:{type:String,attr:"src"},switching:{method:!0},title:{state:!0}}}static get events(){return[{name:"songChanged",method:"songChanged",bubbles:!0,cancelable:!0,composed:!0},{name:"loaded",method:"loaded",bubbles:!0,cancelable:!0,composed:!0}]}static get style(){return":host{display:block;width:100%;-ms-flex:0 0 100%;flex:0 0 100%}:host button{background:none;width:100%;border:0;outline:0;-webkit-appearance:none;-moz-appearance:none;appearance:none;cursor:pointer;display:-ms-flexbox;display:flex;padding:0;-ms-flex-align:center;align-items:center;-ms-flex-pack:start;justify-content:flex-start;position:relative;overflow:hidden;border-top:1px solid var(--color-line)}:host button:focus,:host button:hover{background:var(--color-bg-active)}:host([playing]) button{background:var(--color-bg-playing)!important}:host .index{display:-ms-flexbox;display:flex;-ms-flex-align:center;align-items:center;-ms-flex-pack:center;justify-content:center;height:45px;width:55px;-ms-flex:0 0 55px;flex:0 0 55px;border-right:1px solid var(--color-line);font-size:.75rem;margin:0;margin-right:20px;text-transform:uppercase;color:var(--color-two);letter-spacing:.23em;z-index:1;font-weight:900}:host([playing]) .index{font-size:1.5rem}:host img.preview-image{width:2rem;height:2rem;display:inline-block;margin-right:10px;-webkit-transition:all .15s ease-in-out 0s;transition:all .15s ease-in-out 0s;-webkit-filter:grayscale(100%);filter:grayscale(100%);padding:0;background:#fff;border-radius:4px;z-index:1}:host([playing]) img.preview-image{-webkit-filter:grayscale(0);filter:grayscale(0)}:host h2{z-index:1;color:var(--color-four);font-size:14px;font-weight:400;margin:0;line-height:1;margin-top:-3px;white-space:nowrap}:host h2 span{color:var(--color-two)}:host .tracklisting{overflow:auto;display:-ms-flexbox;display:flex;-ms-flex-align:center;align-items:center;width:100%;height:46px}:host .tracklisting:after{content:\"\";display:block;width:30px;height:30px;-ms-flex:0 0 30px;flex:0 0 30px}:host img.backdrop{position:absolute;width:100%;-webkit-filter:blur(20px) grayscale(75%);filter:blur(20px) grayscale(75%);opacity:.15;z-index:0;mix-blend-mode:color}:host button[data-playing=true] img.preview-image{width:30px;height:30px;-webkit-filter:grayscale(0);filter:grayscale(0)}:host button[data-playing=true] img.backdrop{opacity:1}:host button[data-playing=true] .index,:host button[data-playing=true] h2 span{color:var(--color-three)!important}"}}export{l as StellarSong};