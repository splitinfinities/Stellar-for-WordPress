const t=window.StellarCore.h;import"./chunk-7646164d.js";import{a as e}from"./chunk-340b8099.js";import{k as i}from"./chunk-43ad3764.js";import"./chunk-5ce278cb.js";import{a}from"./chunk-f527ab08.js";import{a as s,b as n}from"./chunk-435d24f9.js";class o{constructor(){this.trackInView=!0,this.preload="auto",this.autoplay=!1,this.muted=!1,this.playsinline=!1,this.controls=!0,this.duration=0,this.startTime=0,this.pausedTime=0,this.currentTime=0,this.playing=!1}componentDidLoad(){this.video_tag=this.element.querySelector("video"),this.video_tag.onplay=(()=>{this.playing=!0,this.played.emit(this.eventData),this.timeupdate.emit(this.eventData)}),this.video_tag.onpause=(()=>{this.playing=!1,this.pausedTime=this.video_tag.currentTime,this.paused.emit(this.eventData),this.timeupdate.emit(this.eventData)}),this.video_tag.onloadedmetadata=(()=>{this.setDimensions(),this.duration=this.video_tag.duration,this.loaded.emit(this.eventData)}),this.trackInView&&this.addIntersectionObserver()}get eventData(){return{playing:this.playing,currentTime:this.currentTime,pausedTime:this.pausedTime,startTime:this.startTime,duration:this.duration}}startInterval(){this.playing?this.interval=setInterval(()=>{this.currentTime=this.video_tag.currentTime,this.timeupdate.emit(this.eventData)},30):clearInterval(this.interval)}setDimensions(){this.width=this.width?this.width:this.video_tag.videoWidth,this.height=this.height?this.height:this.video_tag.videoHeight,e.set({"--width":`${this.width}`,"--height":`${this.height}`,"--aspect-ratio":`${this.height/this.width*100}%`},this.element)}addIntersectionObserver(){"IntersectionObserver"in window?(this.io=new IntersectionObserver(t=>{t[0].isIntersecting?this.handleInScreen():this.handleOffScreen()},{rootMargin:"50%",threshold:[0]}),this.io.observe(this.element.querySelector("video"))):setTimeout(()=>{this.handleInScreen()},300)}handleInScreen(){this.video_tag.play()}handleOffScreen(){this.video_tag.currentTime=0,this.video_tag.pause()}async getDuration(){return this.video_tag.duration}async play(){this.video_tag.play()}async pause(){this.video_tag.pause()}async toggle(){this.video_tag.paused?this.play():this.pause()}async stop(){this.skipTo(0),this.video_tag.pause()}async skipTo(t){await this.pause(),this.video_tag.currentTime=1e3*t,await this.play()}render(){return t("video",{preload:this.preload,width:this.width,height:this.height,autoplay:this.autoplay,muted:this.muted,playsinline:this.playsinline,poster:this.poster,controls:this.controls},t("slot",null))}static get is(){return"stellar-video"}static get properties(){return{autoplay:{type:Boolean,attr:"autoplay"},controls:{type:Boolean,attr:"controls"},currentTime:{state:!0},duration:{state:!0},element:{elementRef:!0},getDuration:{method:!0},height:{type:Number,attr:"height",reflectToAttr:!0,mutable:!0},interval:{state:!0},io:{state:!0},muted:{type:Boolean,attr:"muted"},overlay:{type:Boolean,attr:"overlay"},pause:{method:!0},pausedTime:{state:!0},play:{method:!0},playing:{type:Boolean,attr:"playing",mutable:!0,watchCallbacks:["startInterval"]},playsinline:{type:Boolean,attr:"playsinline"},poster:{type:String,attr:"poster"},preload:{type:String,attr:"preload"},skipTo:{method:!0},startTime:{state:!0},stop:{method:!0},toggle:{method:!0},trackInView:{type:Boolean,attr:"track-in-view"},video_tag:{type:"Any",attr:"video_tag",mutable:!0},width:{type:Number,attr:"width",reflectToAttr:!0,mutable:!0}}}static get events(){return[{name:"timeupdate",method:"timeupdate",bubbles:!0,cancelable:!0,composed:!0},{name:"played",method:"played",bubbles:!0,cancelable:!0,composed:!0},{name:"paused",method:"paused",bubbles:!0,cancelable:!0,composed:!0},{name:"loaded",method:"loaded",bubbles:!0,cancelable:!0,composed:!0}]}static get style(){return"stellar-video{display:block;width:100%;height:0;position:relative;overflow:hidden;padding-bottom:var(--aspect-ratio)}stellar-video:after,stellar-video video{width:100%;height:100%;position:absolute;top:0;left:0;right:0;bottom:0}stellar-video:after{content:\"\";display:block;pointer-events:none;z-index:2;mix-blend-mode:color}stellar-video[overlay]:after{background:linear-gradient(35deg,var(--theme-complement5),var(--theme-base5) 40%,var(--theme-complement5));mix-blend-mode:color}\@media not all and (min-resolution:.001dpcm){\@media{stellar-video[overlay]:after{mix-blend-mode:hard-light;opacity:.5}}}"}}class r{constructor(){this.randomId=Math.floor(6*Math.random())+1,this.color="white",this.width=800,this.height=800,this.aspectRatio=100,this.visualization="bars2",this.loaded=!1,this.loading=!1,this.seekable=!1,this.duration=0,this.current=0,this.visible=!1,this.cache=new WeakMap}componentWillLoad(){e.set({"--width":`${this.width}px`,"--height":`${this.height}px`,"--aspectRatio":`${this.aspectRatio}%`},this.element)}async componentDidLoad(){this.interviewLines||(this.interviewLines=s(this.element)),n(this.interviewLines,this.cache,this.time),this.visualizer=this.element.shadowRoot.querySelector("web-audio-visualizer"),this.video=this.element.shadowRoot.querySelector("stellar-video"),this.addIntersectionObserver()}addIntersectionObserver(){"IntersectionObserver"in window&&(this.io=new IntersectionObserver(t=>{t[0].isIntersecting?this.handleInScreen():this.handleOffScreen()},{rootMargin:"50%",threshold:[0]}),this.io.observe(this.element))}handleTimeUpdate(t){this.playing=t.detail.playing,this.current=Math.abs(Math.round(1e3*t.detail.currentTime)),this.duration=Math.round(1e3*t.detail.duration),n(this.interviewLines,this.cache,this.time)}get time(){return this.current}async handleInScreen(){await i(1e3),this.visible=!0,await i(100),this.visualizer=this.element.shadowRoot.querySelector("web-audio-visualizer"),this.video=this.element.shadowRoot.querySelector("stellar-video"),this.video.addEventListener("canplaythrough",()=>{this.seekable=!0})}async attachContext(){if(!this.context){this.context=new AudioContext;const t=this.context.createMediaElementSource(this.video.video_tag);this.visualizer||(this.visualizer=this.element.shadowRoot.querySelector("web-audio-visualizer"));const e=await this.visualizer.connect(this.context);await t.connect(e.analyser),e.analyser.connect(this.context.destination)}}async handleOffScreen(){this.pause()}async play(){this.video&&await this.video.play()}async skipTo(t){this.video&&await this.video.skipTo(t)}async pause(){this.video&&await this.video.pause()}async toggle(){this.attachContext(),this.video&&await this.video.toggle()}handleClick(){this.toggle(),this.current===this.duration&&this.skipTo(0)}handleCurrentClick(){a.copyPlain(this.current)}render(){return t("div",{class:"card",onDblClick:()=>{this.handleClick()}},!this.visible&&t("div",null,t("skeleton-img",{width:1050,height:600,loading:!0})),this.visible&&t("section",null,t("stellar-video",{controls:!1,autoplay:!0,playsinline:!0,trackInView:!1,onTimeupdate:t=>{this.handleTimeUpdate(t)}},t("source",{src:this.src})),t("div",{class:"transcript"},t("slot",{name:"transcript"})),this.video&&t("web-audio-visualizer",{for:`interview-${this.randomId}`,type:this.visualization,width:1024,height:1024,color:this.color}),t("button",{class:this.loading?"loading button":this.playing?"playing button":"button",onClick:()=>{this.handleClick()}},t("stellar-asset",{name:this.loading?"sync":this.playing?"pause":"play",class:this.loading?"animation-spin":""})),t("h3",null,t("stellar-unit",{class:"current",value:this.current,from:"ms",to:"s",onClick:()=>{this.handleCurrentClick()}})),t("h3",null,t("stellar-unit",{class:"duration",value:this.duration,from:"ms",to:"s"})),this.seekable&&t("stellar-progress",{value:this.current,max:this.duration,noease:!0,blurable:!1,slender:!0,editable:!0,onChange:t=>{this.skipTo(t.detail.value)}})))}static get is(){return"stellar-video-interview"}static get encapsulation(){return"shadow"}static get properties(){return{aspectRatio:{type:Number,attr:"aspect-ratio",mutable:!0},color:{type:String,attr:"color"},context:{state:!0},current:{state:!0},duration:{state:!0},element:{elementRef:!0},height:{type:Number,attr:"height",mutable:!0},interviewLines:{state:!0},io:{state:!0},loaded:{state:!0},loading:{state:!0},pause:{method:!0},play:{method:!0},playing:{type:Boolean,attr:"playing",mutable:!0},randomId:{state:!0},seekable:{state:!0},skipTo:{method:!0},src:{type:String,attr:"src"},toggle:{method:!0},updateFunc:{state:!0},video:{state:!0},visible:{state:!0},visualization:{type:String,attr:"visualization",mutable:!0},visualizer:{state:!0},width:{type:Number,attr:"width",mutable:!0}}}static get style(){return":host{--width:800px;--height:800px}:host,:host div.card{display:block;position:relative}:host div.card{width:auto;height:auto;margin:auto;overflow:hidden}:host div.card section{height:inherit;display:block;position:relative;padding-top:0!important}:host web-audio-visualizer{position:absolute;top:auto;left:0;right:0;bottom:0;width:100%;height:60%;pointer-events:none;z-index:2}:host web-audio-visualizer[type=circle]{height:100%}:host web-audio-visualizer[type=bars2]{width:80%;left:10%;right:10%}:host stellar-360-image,:host stellar-360-video,:host stellar-image,:host stellar-video{--gradient:radial-gradient(circle at 30% 107%,var(--theme-base5) 0%,var(--theme-base8) 5%,var(--theme-complement8) 45%,var(--theme-complement5) 60%,var(--theme-base5) 90%);position:relative;z-index:1;display:block}:host stellar-progress{position:absolute;top:0;left:0;width:100%;z-index:9;--border-radius:0}:host stellar-progress .progress{border:0}:host h3{color:#fff;margin:0}:host stellar-unit{position:absolute;bottom:1rem;z-index:4;color:#fff!important;font-weight:700}:host stellar-unit.current{left:1rem}:host stellar-unit.duration{right:1rem}:host .transcript{position:absolute;bottom:0;width:70%;left:15%;z-index:5;pointer-events:none}:host .button{position:absolute;-webkit-transition:all .35s var(--ease) 0s,background .175s var(--ease) 0s;transition:all .35s var(--ease) 0s,background .175s var(--ease) 0s;width:9rem;height:9rem;top:50%;right:50%;-webkit-transform:translate(50%,-50%);transform:translate(50%,-50%);border-radius:100%;padding:0;border:0;-webkit-appearance:none;-moz-appearance:none;appearance:none;background:#fff;text-align:center;display:-ms-flexbox;display:flex;-ms-flex-align:center;align-items:center;-ms-flex-pack:center;justify-content:center;z-index:4;outline:0;cursor:pointer;padding-left:1rem;mix-blend-mode:soft-light}:host .button:focus,:host .button:hover{-webkit-transform:translate(50%,-50%) scale(1.1);transform:translate(50%,-50%) scale(1.1);mix-blend-mode:hard-light}:host .button stellar-asset{font-size:7rem;margin:auto;display:block}:host .button.loading{padding:0}:host .button.playing{width:2.8rem;height:2.8rem;top:2.2rem;right:1.8rem;padding:0;background:transparent;-webkit-transition:all .35s var(--ease) 0s,background .175s var(--ease) 0s;transition:all .35s var(--ease) 0s,background .175s var(--ease) 0s}:host .button.playing stellar-asset{font-size:2.8rem}:host:after{content:\"\";display:block;width:100%;height:8rem;background:-webkit-gradient(linear,left top,left bottom,from(transparent),to(rgba(0,0,0,.65)));background:linear-gradient(180deg,transparent 0,rgba(0,0,0,.65));filter:progid:DXImageTransform.Microsoft.gradient(startColorstr=\"#00000000\",endColorstr=\"#a6000000\",GradientType=0);position:absolute;z-index:2;bottom:0;left:0;right:0}"}}export{o as StellarVideo,r as StellarVideoInterview};